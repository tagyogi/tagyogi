<!--
	파일정보 : acciPrsr/acciPrsrIns.html
	파일명 : acciPrsr
	업무명 : 가압류수정 수정
	생성자 : 최진호
	생성일 : 2023-04-14
-->
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="/layout/subLayout">
	<body>
		<script th:inline="javascript">
			/*<![CDATA[*/
			var codeList = /*[[${codeList}]]*/; //공통코드
			var gridColList = /*[[${gridColList}]]*/; //그리드옵션
			var gridOptList = []; //그리드옵션
			//var initParam = {codeList : "MB27:MB28", gridNoList : ""}

			//초기화 조회 콜백
			$(document).ready(function(){

				//화면 처리

				//코드값 처리
				com.fnCodeSelectBox("MB27", "sestCd", 0, ""); //압류구분
				com.fnCodeSelectBox("MB28", "canCd", 0, "");  //압류상태

				//데이터 조회
				fnSearch();
			});

			//검색
			var fnSearch = function(){
				var selectParam = { membNo : /*[[${paramMap.membNo}]]*/, sestSeq : /*[[${paramMap.sestSeq}]]*/ , atthType : /*[[${menuInfo.atthType}]]*/ };
				obj = {url:"/acciPrsr/selectAcciPrsr.do", param:selectParam, callBack:fnSelectCallBack, msgYn:"N", sessYn:"Y", loadYn:"Y"};
				com.fnAjaxDef(obj);
			};

			//조합원 정보 조회 콜백
			var fnSelectCallBack = function(resData){
				//console.log(resData);

				//기본 데이터
				com.fnSetKeyVal(resData.memb);
				com.fnSetKeyVal(resData.data);
				
				com.fnIbsUploadView($("#docFile"), resData.fileList);
				
				//알림톡세팅
			 	$("#totalNum").val(resData.memb.investNum); /*알림톡*/
				var setParam = {membNo: resData.memb.membNo, setTalk:"Y"}
				com.fnSetPersList(setParam);
				
				//메뉴탭 조합원명세팅
				let tabObj = {target: $("#ele_membNm").text()}
				com.fnSetTabMembTag(tabObj);
				
			}

			//조합원조회 콜백
			var fnMembInfoSet = function(resData){
				var keyList = Object.getOwnPropertyNames(resData);
				for(var key in keyList ){
					var k = keyList[key].replace(" ", "");

					//조합원 정보
					$("#ele_"+k).text(resData[k]);
					if(k === 'membNo') 	$("#sMembNo").val(resData[k]);
					if(k === 'membNm') 	$("#sMembNm").val(resData[k]);
			 	}
			};

			//저장
			var fnSave = function(){
				//필수체크
				var valChks = ["sMembNo", "sMembNm", "sestDt"];
				if(com.fnValChk(valChks)){
					if(confirm("저장 처리 하시겠습니까?")){
						obj = {url:"/acciPrsr/updateAcciPrsr.do", formId:"saveFrm", fileId:"docFile", callBack:fnSaveCallBack, msgYn:"Y", sessYn:"Y", loadYn:"Y"};
						com.fnAjaxMulti(obj);
						
					}
				}
			};

			//저장콜백
			var fnSaveCallBack = function(resData){
				//성공하면 탭닫고 이동
				if(resData.resultCode === 0){
					
					if($("#sestCd").val() === "1" && $("#canCd").val() === "1"){ //가압류 진행시
						//저장성공시 알림톡발송						
						/*
						param1조합원의 출자금 [param2]좌가 가압류되어 안내드립니다.
						*/
						var totalNum = $("#totalNum").val();
						var paramsArray = [
						  $("#ele_membNm").text() //조합원명
						  ,totalNum            //출자좌수
						];
						
						// 배열을 콜론으로 구분된 문자열로 합치기
						var paramVal = paramsArray.join(':');
						param = {msgSeq:"17", membNo:$("membNo").val(), param:paramVal, telNo:$("#talkTel").val(), telNm:$("#talkNm").val(), msgYn: "N"}
						com.fnSendTalkMsg(param);
					}
					
					parent.closeMenu(/*[[${menuInfo.menuIdx}]]*/, /*[[${menuInfo.refMenuIdx}]]*/);					
				}	
			};

			/*]]>*/

		</script>
		<div class="contentsArea">
			<div class="contentsTop">
				<div th:insert="~{/fragments/subTitle}"></div>

				<!--title 버튼 영역-->
				<div class="topBtnsWrap">
					<!--오른쪽접기화면 컨트롤 버튼-->
					<div class="collapseCtrl">
						<button type="type" class="btn-collapse down active"><span></span></button>
						<button type="type" class="reLoadFrm"></button>
					</div>
				</div>

			</div><!-- //contentsTop -->
			<div class="contents flex">
				
				<!--알림톡 파라미터 : 조합원 출자좌수, form으로 넘어갈 필요없음-->
				<input type="hidden" name="totalNum"    id="totalNum" value=""/>
				
				<form name="saveFrm" id="saveFrm" method="post" onSubmit="return false;" action="">
				<input type="hidden" name="atthType" id="atthType" th:value="${menuInfo.atthType}"/>
				<input type="hidden" name="atthNo" id="atthNo"/>
				<input type="hidden" name="membNo" id="membNo" value="">
				<input type="hidden" name="sestSeq" id="sestSeq" value="">
				<div class="layer-flex collapseArea Collapsedown">
					<!-- 그리드 좌측 부분 -->
					<div class="collapseBox" style="width:49%">
						<!--조합원정보-->
						<th:block th:include="com/comMemb"></th:block>
					</div>
					<!-- 그리드 우측 부분 시작 -->
					<!--여긴 영역 감싼 버전으로 -->
					<!--fixScroll 스크롤 넣으면 안쪽영역으로 -->
					<div class="collapseBox fixable" style="width:49%">

						<!--가압류정보-->
						<section class="area mt5">
							<div class="fl">
								<h4 class="title">가압류 정보</h4>
							</div>
						</section>
						<table class="tbl">
							<colgroup>
								<col style="width:90px;">
								<col style="width:140px;">
								<col style="width:90px;">
								<col style="width:140px;">
								<col style="width:90px;">
								<col style="width:140px;">
							</colgroup>
							<tbody>
								<tr>
									<th>압류사건명</th>
									<td><input type="text" name="caseNm" id="caseNm" size="40" title="압류사건명" maxlength="100" value="" style="max-width:100%;"/></td>
								</tr>
								<tr>
									<th>압류구분</th>
									<td><select name="sestCd" id="sestCd" style="width:100px" title="압류구분"></select></td>
									<th>압류총액</th>
									<td><span><input type="text" name="sestAmt" id="sestAmt" size="15" maxlength="19" title="압류사건명" onkeyup="com.fnOnlyNum(this);com.makeComma(this);" value="" style="max-width:150px;"/></span><span>원</span></td>
									<th>압류상태</th>
									<td><select name="canCd" id="canCd" style="width:100px" title="압류구분"></select></td>
								</tr>
								<tr>
									<th><span class="reqMark">*</span>압류결정일자</th>
									<td>
										<input type="text" name="sestDt" id="sestDt" title="압류결정일자" maxlength="10" style="width:100px;" onkeyup="com.fnOnlyNum(this);com.fnDateMakeForm(this)" onblur="com.fnDateValiChk(this);"/>
										<img src="../images/icon_calendar.png" alt="달력" class="calendar-box" onclick="calendar(this, 'sestDt', 'yyyy-mm-dd','','')" />
									</td>
									<th>종료일자</th>
									<td colspan="3">
										<input type="text" name="endDt" id="endDt" title="종료일자" maxlength="10" style="width:100px;" onkeyup="com.fnOnlyNum(this);com.fnDateMakeForm(this)" onblur="com.fnDateValiChk(this);"/>
										<img src="../images/icon_calendar.png" alt="달력" class="calendar-box" onclick="calendar(this, 'endDt', 'yyyy-mm-dd','','')" />
									</td>
								</tr>
								<tr>
									<th>관할기관명</th>
									<td><input type="text" name="agencyNm" id="agencyNm" size="30" maxlength="50" title="관할기관명" value="" style="max-width:300px;"/></td>
									<th>채권자</th>
									<td colspan="3"><input type="text" name="creditor" id="creditor" size="20" maxlength="20" title="채권자" value="" style="max-width:150px;"/></td>
								</tr>
								<tr>
									<th>청구채권내용</th>
									<td colspan="5"><textArea name="claiCont" id="ele_claiCont"></textArea></td>
								</tr>
								<tr>
									<th>관련압류정보</th>
									<td colspan="5"><textArea name="sestCont" id="ele_sestCont"></textArea></td>
								</tr>
								<tr>
									<th>진행내용</th>
									<td colspan="5"><textArea name="progCont" id="ele_progCont"></textArea></td>
								</tr>
								<tr>
									<th>관련근거</th>
									<td colspan="5"><textArea name="baseCont" id="ele_baseCont"></textArea></td>
								</tr>
							</tbody>
						</table>
						<!--알림톡정보 : s-->
						<div class="wrapBox mt10">
							<th:block th:include="com/comAlarmTalk"></th:block> <!--알람톡정보 -->
							<!--<th:block th:include="com/comAlarmTalk :: type('invtSeprt')"></th:block> -->
						</div><!-- //wrapbox-->
						<!--알림톡정보 : e-->

						<section class="area mt10">
							<div class="fl">
								<h4 class="title">첨부파일<span style="font-size: 11px; color: #ff6600">(첨부할 파일을 끌어다 놓으시거나, 마우스 오른쪽버튼 -> '추가'로 첨부바랍니다.)</span></h4>
							</div>
							<div class="fr">
								<button type="button" onclick="javascript:com.fnDtlFileUpload('docFile', $('#atthType').val(), $('#atthNo').val(), $('#guarNo').val());" class="btn small style07">파일저장</button>
	                        	<button type="button" onclick="javascript:com.fnIbsFileDownAll($('#docFile'));" class="btn small style08">전체다운</button>
	                    	</div>
						</section>
						<div id="docFile" style="height:140px;"></div>

					</div>
				</div>	<!-- END 컨텐츠 영역 -->

				<!-- 처리 버튼 영역 -->
				<div class="layer-flex mt20">
					<div class="" style="width:100%">
						<section class="area">
							<div class="fc">
								<button type="button" onclick="javascript:fnSave();" class="btn style07">저장</button>
							</div>
						</section>
					</div>
				</div>
				<!--처리 버튼 영역 끝-->
				</form>
			</div>
		</div>
	</body>
</html>
