<!--
	파일정보 : sampleG2bNew.html
	파일명 : 조달청연계 테스트 (차세대)
	업무명 : 조달청연계 테스트 (차세대)
	생성자 : DEV
	생성일 : 1900.01.01
-->
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="/layout/subLayout">
	<body>
		<script th:inline="javascript">
			/*<![CDATA[*/

			$(document).ready(function() {
				//fnSearchCallBack();
			});

			//조달청 조회
			var fnSearch = function(){
				var valChks = ["publicNo"];

				if($("#reqType").val() === "unicon"){
					//valChks.push("bizNo");
				}else{
					$("#guarType").val("11");
				}

				if(com.fnValChk(valChks)){
					obj = {url:"/guarElectReq/serchMgwrReq.do", formId:"serchFrm", callBack:fnSearchCallBack, msgYn:"Y", sessYn:"Y", loadYn:"Y"};
					com.fnAjaxPost(obj);
				}
			}

			//조달청 조회 콜백
			var fnSearchCallBack = function(resData){
				console.log(resData);
				$("#ele_g2bInfo").empty();
				if(resData.resultCode === 0) { //성공이면
					var g2bInfo = resData.data;
					$.each( g2bInfo, function( key, value ){
						$("#ele_g2bInfo").append(key + " : " + value + "</br>");
					});
				}
			}

			//조달청전문생성
			var fnG2bCreate = function(guarType){

				$("#guarType").val(guarType);

				//샘플 보증번호 추출(발급현황에서 랜덤 뽑아옴)
				//if(guarType === 11){
				//	$("#guarNo").val("G20241100016");	//bidgua
				//}else{
				//	$("#guarNo").val("G20231204645");	//bidgua

				//}
				//if(guarType === 12)	$("#guarNo").val("G20231204645");	//congua
				//if(guarType === 12)	$("#guarNo").val("G20241200098");	//publicNo : 2023050B2D102

				//if(guarType === 13)	$("#guarNo").val("G20241300021");	//flrgua
				//if(guarType === 14)	$("#guarNo").val("G20241400040");	//pregua

				//GR_G2B 운영 정보 개발로 복사 필요 -- guarElectMapper.selectGuarG2b
				var param = { publicNo: $("#publicNo").val(), guarNo: $("#guarNo").val(), releOrgCd:$("#releOrgCd").val() };
				if(guarType !== 11)	param.bizNo = $("#bizNo").val()
				obj = {url:"/guarElectReq/sendGuarElectMgwr.do", param:param, callBack:fnG2bCreateCallBack, msgYn:"Y", sessYn:"Y", loadYn:"Y"};
				com.fnAjaxDef(obj);
			}

			//조달청 조회 콜백
			var fnG2bCreateCallBack = function(resData){
				console.log(resData);
				$("#ele_recvList").empty();
				if(resData.resultCode === 0) { //성공이면
					var recvInfo = resData.data;
					$.each( recvInfo, function( key, value ){
						$("#ele_recvList").append(key + " : " + value + "</br>");
					});
				}
			}


			//차세대 보증신청서 가져오기
			var fnRecv = function(){
				param = {}
				obj = {url:"/guarElectReq/recvGuarElectMgwr.do", param:param, callBack:fnRecvCallBack, msgYn:"Y", sessYn:"Y", loadYn:"Y"};
				com.fnAjaxDef(obj);
			}
			var fnRecvCallBack = function(resData){
				//alert(1);
			}

			//차세대 보증신청서 신청서 수신 응답처리
			var fnRecvRes = function(){
				var guarNo =  $("#guarNo").val();
				if(com.fnIsEmpty(guarNo))	{
					alert("보증번호를 입력하세요.");
					return;
				}

				param = {guarNo: guarNo};
				obj = {url:"/guarElectReq/sendGuarElectRecvRes.do", param:param, callBack:fnRecvResCallBack, msgYn:"Y", sessYn:"Y", loadYn:"Y"};
				com.fnAjaxDef(obj);
			}
			var fnRecvResCallBack = function(resData){
				//alert(1);
				console.log(resData);
			}

			//g2b 팝업 테스트(차세대)
			var fnG2bSearch = function(){	//guarCom.fnG2bSearch	--> menuCd 변경

				$("#ele_bizNo").text($("#bizNo").val());	//임시

				if($("#publicNo").val() === "") {
			        alert("공고번호를 입력해 주십시오.");
			        $("#publicNo").focus();
			        return;
			    }
				titl = "통합계약정보조회";
				//menuCd = "1070717";	//g2b 구전산		// com/serchG2bContr
				menuCd = "1070735";	//mgwr 차세대(계약)		// com/serchMgwrContr
				if($("#reqType").val() === "intdnt"){
					//alert("미완료");
					titl = "통합입찰정보조회";
					//menuCd = "1070714";	//g2b 구전산		// com/serchG2bBid
					menuCd = "1070734";	//mgwr 차세대(입찰)		// com/serchMgwrBid
				}
				com.dialpopupOpen(titl, "/index/pageCall.do?menuCd=" + menuCd, "800", "740");
			}



			var fnChgNo = function(val){
				if(val === "unicon"){
					$("#publicNo").val("SC1311190000300");
				}else{
					$("#publicNo").val("T23BK00018876");
				}
			}

			//보증업무 > 연계관리 > 전자보증신청 리스트 페이지 이동
			var fnGoList = function(){
				parent.menuOpen({menuCd:"1030503", paramMap:{}});
			}

			/*]]>*/
		</script>

		<!-- 콘텐츠 시작 -->
		<div class="contentsArea">
			<div class="contentsTop">
				<div th:insert="~{/fragments/subTitle}"></div>
			</div><!-- //contentsTop -->

			<div class="contents flex">
				<!-- 검색 부분 -->
				<form name="serchFrm" id="serchFrm" method="post" onSubmit="return false">
				<input type="hidden" name="guarType" id="guarType"/> <!-- 보증서종류 -->
				<!-- 첨부파일 관련 -->
				<input type="hidden" name="atthType" id="atthType" th:value="${menuInfo.atthType}"/>
				<input type="hidden" name="atthNo" id="atthNo"/>

				<div id="ele_bizNo" style="display:none;"></div>	<!-- 임시 -->
				<section class="searchArea mt10">
					<div class="row">
						<dl>
							<dt style="width:90px;">유형</dt>
							<dd style="width:100px;">
								<select name="reqType" id="reqType" style="width:90px" onchange="fnChgNo(this.value);">
									<option value="unicon">통합계약</option>
									<option value="intdnt">통합입찰</option>
									<option value="guisap">보증신청서</option>
								</select>
							</dd>
							<dt >참조번호</dt>
							<dd style="width:160px;">
								<input type="text" name="publicNo" id="publicNo" title="참조번호" style="width:150px" value="SC1311190000300"/>
							</dd>
							<dt >사업자번호(계약)</dt>
							<dd style="width:150px;">
								<input type="text" name="bizNo" id="bizNo" title="사업자번호" style="width:150px" value="4038183359"/>
							</dd>
							<dt >보증번호</dt>
							<dd style="width:160px;">
								<input type="text" name="guarNo" id="guarNo" title="보증번호" style="width:150px" value="G20231204645"/>
							</dd>
						</dl>
						<dl>
							<dt style="width:90px;">연계기관</dt>
							<dd style="width:300px;">
								<select name="releOrgCd" id="releOrgCd" style="width:160px" >
									<option value="">선택</option>
									<option value="z225811077000">강원랜드</option>
									<option value="z305821315800">국가철도공단 KR전자조달시스템</option>
									<option value="z106830701800">방위사업청 국방전자조달시스템(D2B)</option>
									<option value="z121812911401">인천국제공항공사 계약 및 시설관리시스템</option>
									<option value="z305863159000">주식회사 에스알</option>
									<option value="z205820404300">한국과학기술정보연구원 KISTI 전자조달시스템</option>
									<option value="z116820123700">한국국토정보공사</option>
									<option value="z129820010300">한국도로공사 전자조달</option>
									<option value="z138820045100">한국마사회 전자조달</option>
									<option value="z120861894300">한국수력원자력(주) 전자상거래</option>
									<option value="z306820047101">한국수자원공사 전자조달시스템</option>
									<option value="z120820005201">한국전력공사 전자조달시스템</option>
									<option value="z314821002400">한국철도공사 전자조달시스템</option>
									<option value="z129821059500">한국토지주택공사 전자조달시스템(e-bid)</option>

								</select>
								
							</dd>
						</dl>
					</div><!-- //row -->
					<div class="searchBtn">
						<button type="button" onclick="javascript:fnRecvRes();" class="btn search">신청서응답처리(rguisap)</button>
					</div>
				</section>
				<!-- 검색 부분 끝 -->

				<div class="layer-flex mt20">
					<!-- 내용 좌측 부분 -->
					<div class="" style="width:49%">
						<section class="area">
							<div class="fl">
								<h4 class="title">조달청 (입찰: G20241100016 하자:G20241300020 선금 : G20241400038</h4>
								<h4 >계약:G20231204645(publicNo: T24JE00001416, bizNo: 1198203684 -- 기등록)</h4>
							</div>
							<div class="fr">
								<button id="btnIns" onclick="javascript:fnSearch();" class="btn style01">입찰조회</button>
								<button id="btnIns" onclick="javascript:fnSearch();" class="btn style01">계약조회</button>
								<button id="btnIns" onclick="javascript:fnG2bSearch();" class="btn style01">조회팝업</button>
								<button id="btnIns" onclick="javascript:fnG2bCreate(11);" class="btn style03">입찰전문</button>
								<button id="btnIns" onclick="javascript:fnG2bCreate(12);" class="btn style03">계약전문</button>
								<button id="btnIns" onclick="javascript:fnG2bCreate(13);" class="btn style03">하자전문</button>
								<button id="btnIns" onclick="javascript:fnG2bCreate(14);" class="btn style03">선금전문</button>
							</div>
						</section>
						<!-- 상단 부분 끝 -->
						<table class="tbl mt10" >
							<colgroup>
								<col style="width:130px;">
								<col style="">
							</colgroup>
							<tbody>
								<tr>
									<td>
										<textare id="ele_g2bInfo" rows="50" cols="80"></textare>
									</td>
								</tr>
							</tbody>
						</table>

						<section class="area">
							<div class="fl">
								<h4 class="title">보증신청서( 배치 신청서 경로 파일 확인 -> 응답처리 )</h4>
							</div>
							<div class="fr">
								<button id="btnIns" onclick="javascript:fnRecv();" class="btn style05">신청서, 2차응답서 조회</button>
								<button id="btnIns" onclick="javascript:fnGoList();" class="btn style08">신청서리스트(응답, 재전송처리 테스트)</button>
							</div>
						</section>

					</div>
					<!-- 내용 좌측 부분 끝 -->
					<!-- 내용 우측 부분 -->
					<div class="" style="width:49%">
						<form name="procFrm" id="procFrm" method="post" onSubmit="return false">
						<!-- 상단 부분 -->
						<section class="area">
							<div class="fl">
								<h4 class="title">응답</h4>
							</div>
							<div class="fr">
								<!--
								<button id="btnIns" onclick="javascript:fnG2bSend();" class="btn style08">전송</button>
								-->
							</div>
						</section>
						<!-- 상단 부분 끝 -->
						<table class="tbl mt10" >
							<colgroup>
								<col style="width:100px;">
								<col style="">
							</colgroup>
							<!-- 상단 부분 끝 -->
							<table class="tbl mt10" >
								<colgroup>
									<col style="width:130px;">
									<col style="">
								</colgroup>
								<tbody>
									<tr>
										<td>
											<textare id="ele_recvList" rows="50" cols="80"></textare>
										</td>
									</tr>
								</tbody>
							</table>
						</table>
						</form>
					</div>
					<!-- 내용 우측 부분 끝 -->
					<!-- END 컨텐츠 영역 -->
				</div>
				</form>
			</div><!-- //contents -->
		</div><!-- //contentsArea -->
	</body>
</html>