<!--
	파일정보 : docList.html
	파일명 : 서식관리
	업무명 : 서식관리
	생성자 : BSG
	생성일 : 2023.08.30
-->
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="/layout/subLayout">
	<body>
		<script th:inline="javascript">
			/*<![CDATA[*/
			var codeList = /*[[${codeList}]]*/; //공통코드
			var gridColList = /*[[${gridColList}]]*/; //그리드옵션
			var gridOptList = []; //그리드옵션

			//초기화 조회 콜백
			$(document).ready(function(){

				//INPUT 설정
				com.fnCodeSelectBox("CM16", "sWorkCd", 2, "" ); //업무구분
				com.fnCodeSelectBox("CM16", "workType", 1, "" ); //업무구분
				com.fnCodeSelectBox("SY02", "useYn", 1, "" ); //사용여부

				com.fnIbsUploadOne($("#myUpload"), 1);

				//IBsheet 초기화
				com.fnIbsInit(/*[[${menuInfo.workGrid}]]*/);

				//초기 데이터 설정 (id : 시트 객체 ID, el : 시트를 생성할 DIV객체 ID, options : 초기화 구문 변수, data : DATA)
			    IBSheet.create({ id: "sheet", el: "sheetDiv", options: gridOptList[0] });

			    //시트 생성 이후
			    IBSheet.onRenderFirstFinishAll = function(obj){
					fnSearch(); //조회 호출
				};

				//sheet 원클릭 처리
				sheet.bind("onAfterClick" , function(obj) { //원클릭
					if(obj.kind === "Filter") return;
					rowData = this.getFocusedRow(); //생성된 행 정보 가져오기

					fnSearchFile(rowData.atthNo, $("#atthType").val());//첨부파일 조회

					for(var elem in rowData){
						$("#"+elem).val(rowData[elem]);
					}

					if(obj.col === "btnDown"){
						var fileInfo = $("#atthType").val() + ":" + rowData.atthNo + ":1";
						console.log(fileInfo);
						com.fnFileDown(fileInfo);

					}else{
						//버튼활성화
						fnBtnDis(false, false, true, true);
						$("#atthNo").val(rowData.atthNo); //해당 파일번호 세팅
					}

				});

				//버튼 초기
				$("#saveFrm button").prop("disabled", true);
				$("#btnIns").attr("disabled", false);
			});

			//현황 조회
			var fnSearch = function(){
				param = JSON.stringify($("#serchFrm").serializeObject());
				com.fnIbsSearch("/doc/selectDocList.do", param); //param, sheetId 생략 가능
			};

			//첨부파일 현황 조회
			var fnSearchFile = function(atthNo, atthType){
				 var param = {atthNo : atthNo, atthType: atthType};
				obj = {url:"/doc/selectDocFileList.do", param:param, callBack:fnSearchFileCallBack, msgYn:"N", sessYn:"Y", loadYn:"Y"};
				com.fnAjaxDef(obj);
			};
			
			//첨부파일 현황 조회 콜백
			var fnSearchFileCallBack = function(resData){
				
				//재세팅전 초기화
				var setObj = new Object();
				setObj.files = null;
				$("#myUpload").IBUpload(setObj);
				
				if(resData.fileList != null && resData.fileList != ''){
					com.fnIbsUploadView($("#myUpload"), resData.fileList);
				}else{
					$("#myUpload").IBUpload("reset");//첨부파일 초기화
				}
			}

			//신규버튼
			var fnIns = function(){
				$("#saveFrm")[0].reset();

				$("#saveFrm #workType").prop("disabled", false);
				$("#saveFrm #docNm").prop("disabled", false);
				$("#saveFrm #useYn").prop("disabled", false);
				$("#saveFrm #docCont").prop("disabled", false);

				//버튼활성화
				fnBtnDis(true, true, false, false);

				//$("#myUpload").html("");//첨부파일 초기화
				$("#myUpload").IBUpload("reset");
				$("#atthNo").val(""); //파일번호 초기화

				$("#useYn").val("Y");
				$("#docNo").val("");
			};

			//수정버튼
			var fnUpt = function(){

				//버튼활성화
				fnBtnDis(true, true, false, false);

			};

			//취소버튼
			var fnCan = function(){
				//선택 row 또는 키 값이 있을경우, 비활성화 후 정보 세팅
				$("#saveFrm")[0].reset();

				//버튼활성화
				fnBtnDis(false, true, true, true);

			 	$("#docNo").val("");
			 	$("#atthNo").val("");
			 	$("#myUpload").IBUpload("reset");
			};

			//버튼 활성화처리
			var fnBtnDis = function(bolIns, bolUpt, bolCan, bolSave){

				$("#saveFrm #workType").prop("disabled", bolCan);
				$("#saveFrm #docNm").prop("disabled", bolCan);
				$("#saveFrm #docCont").prop("disabled", bolCan);
				$("#saveFrm #useYn").prop("disabled", bolCan);
				$("#saveFrm #refVal").prop("disabled", bolCan);

			 	$("#btnIns").attr("disabled", bolIns);
			 	$("#btnUpt").attr("disabled", bolUpt);
			 	$("#btnCan").attr("disabled", bolCan);
			 	$("#btnSave").attr("disabled", bolSave);
			}


			//저장버튼
			var fnSave = function(){

				//필수체크
				var valChks = ["workType", "docNm", "docCont", "useYn"];

				if(com.fnValChk(valChks)){
					//파일여부
					var fileList = $("#myUpload").IBUpload('fileList');
					if(fileList.length === 0){
						alert("파일을 첨부하십시오.");
						return;
					}

					//신규, 수정 확인
					var newYn = $("#docNo").val();
					var msg = "저장";
					var url = "/doc/insertDoc.do";

					if(newYn !== ""){
						msg = "수정";
						url = "/doc/updateDoc.do";
					}

					if(confirm(msg + " 하시겠습니까?")){
						obj = {url:url, formId:"saveFrm", fileId:"myUpload", callBack:fnSaveCallBack, msgYn:"Y", sessYn:"Y", loadYn:"Y"};
						com.fnAjaxMulti(obj);
					}
				}
			};

			//저장콜백
			var fnSaveCallBack = function(resData){
				$("#saveFrm")[0].reset();

				//버튼활성화
				fnBtnDis(false, true, true, true);

				//파일 삭제
				$("#myUpload").IBUpload("selectAll");
				$("#myUpload").IBUpload("delete");

				fnSearch();
			}

			/*]]>*/
		</script>

		<!-- 콘텐츠 시작 -->
		<div class="contentsArea">
			<div class="contentsTop">
				<div th:insert="~{/fragments/subTitle}"></div>
				<div class="collapseCtrl">
					<button type="type" class="btn-collapse down"><span></span></button>
<!--					<button type="type" class="btn-collapse close"><span></span></button>-->
					<button type="type" class="reLoadFrm"></button>
				</div>
			</div><!-- //contentsTop -->

			<div class="contents flex">
				<!-- 검색 부분 -->
				<form name="serchFrm" id="serchFrm" method="post" onSubmit="return false">
				<section class="searchArea mt10">
					<div class="row">
						<dl>
							<dt>업무구분</dt>
							<dd style="width:120px;">
								<select name="sWorkCd" id="sWorkCd" style="width:120px;"></select>
							</dd>
						</dl>
						<dl>
							<dt>서식명</dt>
							<dd style="width:180px;">
								<input type="search" name="sDocNm" id="sDocNm" style="width:200px;"/>
							</dd>
						</dl>
					</div><!-- //row -->

					<div class="searchBtn">
						<button type="button" onclick="javascript:fnSearch();" class="btn search">조회</button>
					</div>
				</section>
				</form>
				<!-- 검색 부분 끝 -->

				<div class="layer-flex mt20 collapseArea">
					<!-- 내용 좌측 부분 -->
					<div class="collapseBox" style="width:65%">
						<div class="mt10">
					    	<div id="sheetDiv" style="width:100%;height:500px"></div>
						</div>
					</div>
					<!-- 내용 좌측 부분 끝 -->
					<!-- 내용 우측 부분 -->
					<div class="collapseBox fixable" style="width:33%">
						<form name="saveFrm" id="saveFrm" method="post" onSubmit="return false">
						<input type="hidden" name="atthType" id="atthType" th:value="${menuInfo.atthType}"/>
						<input type="hidden" name="atthNo" id="atthNo" value=""/>
						<input type="hidden" name="docNo" id="docNo" value=""/>
						<input type="hidden" name="file" id="file" value=""/>

						<!-- 상단 부분 -->
						<section class="area">
							<div class="fr">
								<button id="btnIns" onclick="javascript:fnIns();" class="btn style08">신규</button>
								<button id="btnUpt" onclick="javascript:fnUpt();" class="btn style08">수정</button>
								<button id="btnCan" onclick="javascript:fnCan();" class="btn style08">취소</button>
								<button id="btnSave" onclick="javascript:fnSave();" class="btn style07">저장</button>
							</div>
						</section>
						<!-- 상단 부분 끝 -->
						<table class="tbl mt10" >
							<colgroup>
								<col style="width:100px;">
								<col style="">
								<col style="width:100px;">
								<col style="">
							</colgroup>
							<tbody>
								<tr>
									<th>업무구분</th>
									<td colspan="3">
										<select name="workType" id="workType" style="width:100px;" title="업무구분" disabled></select>
									</td>
								</tr>
								<tr>
									<th>서식명</th>
									<td colspan="3">
										<input type="search" name="docNm" id="docNm" title="레포트명" style="width:200px;" disabled>
									</td>
								</tr>
								<tr>
									<th>사용여부</th>
									<td colspan="3">
										<select name="useYn" id="useYn" style="width:100px;" title="사용여부" disabled></select>
									</td>
								</tr>
								<tr>
									<th>서식내용</th>
									<td colspan="3">
										<input type="search" name="docCont" id="docCont" title="서식내용" style="width:300px;" disabled>
									</td>
								</tr>
								<tr>
									<th>첨부파일</th>
									<td colspan="3">
										<div id="myUpload"></div>
									</td>
								</tr>
							</tbody>
						</table>
						</form>
					</div>
					<!-- 내용 우측 부분 끝 -->
					<!-- END 컨텐츠 영역 -->
				</div>
			</div><!-- //contents -->
		</div><!-- //contentsArea -->
		<iframe id="downfrm" style="display:none;" title="오즈설치용"></iframe> <!-- 오즈설치용 -->
	</body>
</html>