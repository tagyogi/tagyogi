<!--
	파일정보 : brd/brdUpt.html
	파일명 : brdUpt
	업무명 : 게시판수정
	생성자 : BSG
	생성일 : 2023.04.21
-->
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="/layout/subLayout">
	<body>
		<script th:src="@{/ckeditor/build/ckeditor.js}"></script>
		<script th:inline="javascript">
			/*<![CDATA[*/ 
			//초기화 조회 콜백
			var fnInitCallBack = function(resData){
				
				//첨부파일사용여부
				if(resData.brdMas.atthYn === "Y"){
					$("#ele_atthArea").css("display", "block");
					//동적 첨부파일 (다건)
					com.fnIbsUploadView($("#myUpload"), resData.fileList); 
				}else{
					$("#ele_atthArea").remove();
				}
				
				//공지사용여부 notiYn
				if(resData.brdMas.notiYn !== "Y"){
					$("input[name^='notiYn'").attr("checked", false);
					$("input[name^='notiYn'").attr("disabled", true);
				}
				if(resData.brdMas.topYn !== "Y"){
					$("input[name^='topYn'").attr("checked", false);
					$("input[name^='topYn'").attr("disabled", true);
				}
				
				//에디터 호출
				
				var htmlString = resData.data.brdCont
				
				// 하나의 정규식 패턴으로 <style> 또는 <link> 태그 확인
				const styleOrLinkTagPattern = /<style[^>]*>[\s\S]*?<\/style>|<link[^>]*>/i;
				
				//style link 태그있으면 복사할 수 있게 표출
				if (styleOrLinkTagPattern.test(htmlString)){
					$("#cloneArea").show();
					$("#contTxt").text(htmlString);
					
				} 
								
				$("#editor").html(resData.data.brdCont);
				com.fnCkeditorSet("#editor");	
				
				var keyList = Object.getOwnPropertyNames(resData.data);
				for(var key in keyList ){
					var k = keyList[key].replace(" ", "");
					$("#"+k).val(resData.data[k]);
			 	}
			 	
			};
			
			//저장
			var fnSave = function(){
				//필수체크
				var valChks = ["brdSubj"];
				
				if(com.fnValChk(valChks)){
					if(confirm("저장 처리 하시겠습니까?")){
						
						//파일 업로드 처리(파일이 없어도 첨부파일 번호 추출을 위해 호출)
						if($("#atthType").val() === ""){
							fnIbsFileUploadCallBack();
						}else{
							com.fnIbsFileUpload($("#myUpload"), $("#atthType").val(), $("#atthNo").val());
						}

						$("#brdCont").val(editor.getData());
						obj = {url:"/brd/updateBrd.do", formId:"saveFrm", fileId:"myUpload", callBack:fnSaveCallBack, msgYn:"Y", sessYn:"Y", loadYn:"Y"};
						com.fnAjaxMulti(obj);
											
					}
				}
			};
			
			//첨부파일 처리 콜백
			var fnIbsFileUploadCallBack = function(atthNo){
				//$("#brdCont").val(editor.getData()); //게사판내용삽입
				//obj = {url:"/brd/updateBrd.do", formId:"saveFrm", callBack:fnSaveCallBack, msgYn:"Y", sessYn:"Y", loadYn:"Y"};
				//com.fnAjaxMulti(obj);
			};
			
			//저장 콜백
			var fnSaveCallBack = function(resData){
				var menuCd = "";
				
				if(resData.brdNo !== '0'){
					menuCd = 1070216;//brdDtl
				}else{
					menuCd = 1070219;//brdDtl2-콘텐츠
				}
				
				if(resData.resultCode === 0) {//정상처리시
				
					//상세화면 호출 
					menuNm = /*[[${paramMap.menuNm}]]*/;
					param = {menuCd:menuCd, title:menuNm + '상세'
							, paramMap:{menuNm:menuNm
										, brdNo:$("#brdNo").val()
										, brdSeq:$("#brdSeq").val()
										, atthType:$("#atthType").val()
										, atthNo:$("#atthNo").val()
										, imgAtthNo:$("#imgAtthNo").val()
										} 
					};
					
					parent.menuOpen(param);
					parent.closeMenu(/*[[${menuInfo.menuIdx}]]*/);//현재창 닫기
				}
			};
			
			//화면 초기화(게시판정보 조회)
			$(document).ready(function(){
				obj = {url:"/brd/selectBrd.do", formId:"saveFrm", callBack:fnInitCallBack, msgYn:"N", sessYn:"Y", loadYn:"Y"};
				com.fnAjaxPost(obj);
			});
		    /*]]>*/
		    
		    
            
		</script>
		
		<!-- 콘텐츠 시작 -->
		<div class="contentsArea">
			<div class="contentsTop">
				<h2 id="menuTitle">[[${menuInfo.menuPath}]] <b style="color:#138cc4">[[${paramMap.menuNm}]]수정</b></h2>
			</div><!-- //contentsTop -->
			<form name="saveFrm" id="saveFrm" method="post" onSubmit="return false">
			<input type="hidden" name="brdNo" id="brdNo" th:value="${paramMap.brdNo}"/>
			<input type="hidden" name="brdSeq" id="brdSeq" th:value="${paramMap.brdSeq}"/>
			<input type="hidden" name="atthType" id="atthType" th:value="${paramMap.atthType}"/>
			<input type="hidden" name="atthNo" id="atthNo" value=""/>
			<input type="hidden" name="imgAtthNo" id="imgAtthNo" value=""/>
			<input type="hidden" name="brdCont" id="brdCont" value=""/>
			<div class="contents flex">
				<div class="layer-flex">
					<!-- 그리드 좌측 부분 -->
					<div class="" style="width:100%">
						<table class="tbl">
							<colgroup>
								<col style="width:10%;">
								<col style="width:25%;">
								<col style="width:10%;">
								<col style="width:25%;">
								<col style="width:10%;">
								<col style="width:25%;">
							</colgroup>
							<tbody>
								<tr>
									<th>제목</th>
									<td colspan="5">
										<input type="search" name="brdSubj" id="brdSubj" title="제목" style="width:100%;" maxlength="50">
									</td>
								</tr>
								<tr>
									<th>게시여부</th>
									<td>
										<input type="radio" name="viewYn" id="viewY" value="Y" checked> Y
										<input type="radio" name="viewYn" id="viewN" value="N" > N
									</td>
									<th>공지여부</th>
									<td>
										<input type="radio" name="notiYn" id="notiY" value="Y"> Y
										<input type="radio" name="notiYn" id="notiN" value="N" checked> N
									</td>
									<th>상단고정여부</th>
									<td>
										<input type="radio" name="topYn" id="topY" value="Y"> Y
										<input type="radio" name="topYn" id="topN" value="N" checked> N
									</td>
								</tr> 
							</tbody>
						</table>
						<div class="ckEdirorWrap" style="width:100%;min-height:630px;overflow:auto">
							<textarea id="editor" name="editor"></textarea>
						</div>
						
						<div id="cloneArea" class="mt20" style="display:none; width:100%;">
							<h4 class="title">복사용 코드 <span style="font-size: 12px; ">(외부 style태그를 포함한 코드는, 하단의 원태그를 복사하여 붙여넣으신 후 수정해주세요)</span> </h4>
							<div id="contTxt" style="border: 1px solid #ccc;  height:250px; overflow:auto; padding: 20px; box-sizing: border-box;"></div>
						</div>
						
						<div id="ele_atthArea">
							<section class="area mt10">
								<div class="fl">
									<h4 class="title">첨부파일</h4>
								</div>
								<div class="fr">
		                           <button type="button" onclick="javascript:com.fnIbsFileDownAll($('#myUpload'));" class="btn small style08">전체다운</button>
		                           <button type="button" onclick="javascript:com.fnIbsFileAdd($('#myUpload'));" class="btn small style08">추가</button>
		                           <button type="button" onclick="javascript:com.fnIbsFileDel($('#myUpload'));" class="btn small style08">삭제</button>
		                        </div>
							</section>
							<div id="myUpload" style="height:140px;"></div>
						</div>
						<!-- 처리 버튼 영역 -->
						<section class="area mt50">
							<div class="fc">
								<button type="button" onclick="javascript:fnSave();" class="btn style07">저장</button>
							</div>
						</section>
					</div>	
					<!-- END 컨텐츠 영역 -->
				</div>
			</div><!-- //contents -->
			</form>
		</div><!-- //contentsArea -->
	</body>
</html>