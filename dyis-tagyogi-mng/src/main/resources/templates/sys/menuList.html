<!--
	파일정보 : sys/menuList.html
	파일명 : 메뉴현황
	업무명 : 메뉴현황 조회, 등록, 수정
	생성자 : 변성균
	생성일 : 2023.03.09
-->
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="/layout/subLayout">
	<body>
		<script th:inline="javascript">
			/*<![CDATA[*/
			var codeList = /*[[${codeList}]]*/; //공통코드
			var gridOptList = /*[[${gridOptList}]]*/; //그리드옵션
			var menuList;
			
			var reloadYn = false; //탭클릭시 화면 리로드 여부
			//초기화 조회 콜백
			$(document).ready(function(){
				if(gridOptList === null){ //최초 개발
					gridOptList = [];
					gridOptList[0]  = {
							    "Def": {},
							    "Cfg": {
							        "FitWidth": true,
							        "InfoRowConfig": {
							            "Space": "Bottom"
							        },
							        "Size": "Small",
							        "SectionCanResize": 1,
							        "HeaderMerge": 3,
							        "MainCol": "menuCd",
							        "CanEdit" :1
							    },
							    "Cols": [
							        { "Align": "center", "CanEdit": "1", "MinWidth": "120", "Name": "menuCd", "RelWidth": 1,"Type": "Text","Header": ["메뉴코드"], "Required": "0"},
							        {"Align": "center","CanEdit": "1","MinWidth": "60","Name": "parentCd","RelWidth": 1,"Type": "Text","Header": ["부모"],"Required": "1"},
							        {"Align": "center","CanEdit": "1","MinWidth": "60", "Name": "menuStep","RelWidth": 1,"Type": "Text","Header": ["단계"],"Required": "1"},
							        {"Align": "center","CanEdit": "1","MinWidth": "120","Name": "menuNm","RelWidth": 1,"Type": "Text","Header": ["메뉴명"],"Required": "1"},
							        {"Align": "left","CanEdit": "1","MinWidth": "160","Name": "menuPage","RelWidth": 1,"Type": "Text","Header": ["메뉴페이지"],"Required": null},
							        {"Align": null,"CanEdit": "1","MinWidth": "100","Name": "refVal","RelWidth": 1,"Type": "Text","Header": ["참조값"],"Required": null},
							        {"Align": "Center","CanEdit": "0","MinWidth": "60","Name": "btnView","RelWidth": 1,"Type": "Button","Header": ["미리보기"],"Required": "0"},
							        {"Enum": "|Y|N","Align": "Center","CanEdit": "1","MinWidth": "80","Name": "menuYn","RelWidth": 1,"Type": "Radio","Header": ["메뉴여부"],"Required": "1","EnumKeys": "|Y|N"},
							        {"Enum": "|Y|N","Align": "Center","CanEdit": "1","MinWidth": "80","Name": "useYn","RelWidth": 1,"Type": "Radio","Header": ["사용여부"],"Required": "1","EnumKeys": "|Y|N"},
							        {"Align": null,"CanEdit": "1","MinWidth": "60","Name": "menuSeq","RelWidth": 1,"Type": "Text","Header": ["순번"],"Required": "0"        },
							        {"Align": null,"CanEdit": "0","MinWidth": "120","Name": "topMenuCd","RelWidth": 0,"Type": "Text","Header": ["최상위코드"],"Required": null, "Visible":"0" },
							        {"Align": "Center","CanEdit": "1","MinWidth": "80","Name": "atthType","RelWidth": 1,"Type": "Text","Header": ["첨부코드"],"Required": "0"},
							        {"Align": "Center","CanEdit": "1","MinWidth": "150","Name": "workCd","RelWidth": 1,"Type": "Text","Header": ["공통코드"],"Required": "0"},
							        {"Align": "Center","CanEdit": "1","MinWidth": "150","Name": "workGrid","RelWidth": 1,"Type": "Text","Header": ["그리드정보"],"Required": "0"},
							        {"Enum": "|Y|N","Align": "Center","CanEdit": "1","MinWidth": "80","Name": "sessYn","RelWidth": 1,"Type": "Radio","Header": ["세션여부"],"EnumKeys": "|Y|N"},
							        {"Align": null,"CanEdit": "1","MinWidth": "100","Name": "menuType","RelWidth": 1,"Type": "Text","Header": ["메뉴유형"],"Required": "0"},
							        {"Enum": "|Y|N","Align": "Center","CanEdit": "1","MinWidth": "80","Name": "mobileYn","RelWidth": 1,"Type": "Radio","Header": ["모바일메뉴여부"],"EnumKeys": "|Y|N"},
							    ]
							};
				}else{

					com.fnIbsInit(); //IBsheet 초기화

					//추가 옵션
					gridOptList[0].Cfg.MainCol = "menuCd"; //트리기준값 설정
				}

				//추가 옵션
				gridOptList[0].Cfg.MainCol = "menuCd"; //트리기준값 설정

				//초기 데이터 설정 (id : 시트 객체 ID, el : 시트를 생성할 DIV객체 ID, options : 초기화 구문 변수, data : DATA)
			    IBSheet.create({ id: "sheet", el: "sheetDiv", options: gridOptList[0] });

			    //시트 생성 이후
			    IBSheet.onRenderFirstFinishAll = function(obj){
					fnSearch2(); //조회 호출
				};

			    //저장후 이벤트
			    sheet.bind("onAfterSave" , function(obj) {
					resData = JSON.parse(obj.response.response);
					alert(resData.resultMsg);
			        if (resData.resultCode === 0) {
					    fnSearch2(); //조회 호출
			        }
				});

				//원클릭 처리
				sheet.bind("onAfterClick" , function(obj) { //원클릭
					if(obj.kind === "Filter") return;
					//console.log(obj.row.menuCd);
					if(obj.col === "btnView"){
						if(obj.row.menuPage !== null){
							param = {menuCd:obj.row.menuCd, paramMap:{} };
							parent.menuOpen(param);
						}
					};
				});
			});


			//현황 조회
			var fnSearch2 = function(){
				param = {};
				obj = {url:"/menu/selectMenuList.do", param:param, callBack:fnSearchCallBack, msgYn:"N", sessYn:"Y", loadYn:"Y"};
				com.fnAjaxDef(obj);
			};

			//검색 콜백
			var fnSearchCallBack = function(resData){

				menuList = resData.data;
				//console.log(resData.data);
				var menuTop = [];
				var depth1 = 0;
				var depth2 = 0;

				$.each(resData.data, function(idx, row){
					if(row.menuStep === 1){
						depth1 = menuTop.length;
						menuTop[depth1] = row;
					};

					if(row.menuStep === 2){
						if(menuTop[depth1].Items === undefined) menuTop[depth1].Items = [];
						depth2 = menuTop[depth1].Items.length;
						menuTop[depth1].Items[depth2] = row;
					}

					if(row.menuStep === 3){
						if(menuTop[depth1].Items[depth2].Items === undefined) menuTop[depth1].Items[depth2].Items = [];
						menuTop[depth1].Items[depth2].Items[menuTop[depth1].Items[depth2].Items.length] = row;

					}

				});
				//console.log(menuTop);

				sheet.loadSearchData(menuTop); // 데이타 로딩

				sheet.showTreeLevel(1);
			};

			//행 추가
			var fnRowAdd = function(){
				row = sheet.getFocusedRow(); //생성된 행 정보 가져오기
				if(row.menuStep === "3"){
					initData = {parentCd:row.parentCd, menuStep:row.menuStep, useYn:"Y", menuYn:"Y"};
					com.fnIbsRowAdd("cur", initData, sheet, "N"); //위치, 삽입데이터, sheetId, edit 활성화여부

				}else{
					initData = {parentCd:row.menuCd, menuStep:row.menuStep + 1, useYn:"Y", menuYn:"Y"};
					com.fnIbsRowAdd("tree", initData, sheet, "N"); //위치, 삽입데이터, sheetId, edit 활성화여부

				}
				//sheet.setAttribute(null, "ColName", "CanEdit", 0, 1);
			};


			/*]]>*/
		</script>

		<!-- 콘텐츠 시작 -->
		<div class="contentsArea">
			<div class="contentsTop">
				<h2 id="menuTitle">메뉴현황</h2>
			</div><!-- //contentsTop -->

			<div class="contents flex">
				<div class="layer-flex mt20">
					<!-- 그리드 좌측 부분 -->
					<div class="" style="width:100%">
						<!-- 그리드 상단 부분 -->
						<section class="area">
							<div class="fr">
								<a href="javascript:fnRowAdd();" class="btn style08">행추가</a>
								<a href="javascript:com.fnIbsRowDel();" class="btn style08">행삭제</a>
								<a href="javascript:com.fnIbsSave('/menu/saveMenu.do');" class="btn style07">저장</a>
								<a href="javascript:fnSearch2();" class="btn style01">조회</a>
								<a href="javascript:fnExcel();" class="btn style04">엑셀</a>
							</div>
						</section>
						<!-- 그리드 상단 부분 끝 -->
						<div class="mt10">
					    	<div id="sheetDiv" style="width:100%;height:600px"></div>
						</div>
					</div>
					<!-- 그리드 좌측 부분 끝 -->
					<!-- END 컨텐츠 영역 -->
				</div>
			</div><!-- //contents -->
		</div><!-- //contentsArea -->
	</body>
</html>