<!--
	시스템구분 : 홈페이지
	파일정보 : install.html
	파일명 : 메인
	업무명 : 
	생성자 : 
	생성일 : 
-->
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="/layout/basicLayout" xml:lang="ko">
	<body>
		<script th:src="@{/markany/js/MaXHRControl.js}"></script>
		<script th:src="@{/js/ozws.js}"></script>
		<script th:inline="javascript">
			/*<![CDATA[*/
			// OS
			var OSTYPE_WIN32					= "Win32";
			var OSTYPE_WIN64					= "Win64";
			var OSTYPE_MAC						= "MAC";
			var OSTYPE_UNKNOWN                  = "Unknown";
			var Client_OS						= "Win32";
			
			if(navigator.platform == OSTYPE_WIN32) Client_OS = OSTYPE_WIN32;
			else if(navigator.platform == OSTYPE_WIN64) Client_OS = OSTYPE_WIN64;
			else if(navigator.platform == "MacIntel") Client_OS = OSTYPE_MAC;
			else Client_OS = OSTYPE_UNKNOWN;
	
			//공인인증서설치여부
			var isInstall = {unicrs:false};
			
			var unicrsVersion = "2.0.11.2";
			var unicrsSrc = "https://127.0.0.1:15018";
			

			var chkVal = /*[[${chkVals}]]*/; //설치대상
			//화면 초기화 처리 호출
			$(document).ready(function(){
				
				if(chkVal === null){
					alert("올바른 접근 방식이 아닙니다.");
					location.href="/";
					return;
				}
				chkVals = chkVal.split(":"); 
				if(chkVals[0] === "Y"){
					$("#certTxt > div").text("설치됨");
					$("#certTxt button").prop("disabled", true);
					$("#certTxt button").hide();
				}else{
					
					$("#certTxt > div").text("미설치");
					$("#certTxt button").prop("disabled", false);
					$("#certTxt button").show();
				}
				
				if(chkVals[1] === "Y"){
					$("#markTxt > div").text("설치됨");
					$("#markTxt button").prop("disabled", true);
					$("#markTxt button").hide();	
				}else{
					$("#markTxt > div").text("미설치");
					$("#markTxt button").prop("disabled", false);
					$("#markTxt button").show();
				}
				
				if(chkVals[2] === "Y"){
					$("#ozTxt > div").text("설치됨");
					$("#ozTxt button").prop("disabled", true);
					$("#ozTxt button").hide();	
				}else{
					$("#ozTxt > div").text("미설치");
					$("#ozTxt button").prop("disabled", false);
					$("#ozTxt button").show();
				}
				
				
			});
			
			/*** 설치 ***/
			// ############ 공인증서 설치 부분 ######################################//
			//인증서설치 호출
			var fnReInstallCert = function(){
				if(Client_OS == OSTYPE_MAC)
					document.getElementById("downfrm").src = '/CC_WSTD_home/install/UniSignCRSV3Setup.pkg';	
				else
					document.getElementById("downfrm").src = '/CC_WSTD_home/install/UniSignCRSV3Setup.exe';	
				
				UniCRSChecker();
			}
			
			var count = 0;
			var UniCRSChecker = function(){
				count++;
				var fnResult2 = function(obj, r){
					if(obj && obj.parentNode) obj.parentNode.removeChild(obj);
					var fnlogic = function(){
						if(r){
							var j = document.createElement('script');
							var url = unicrsSrc + "/VER?UniCRSVersion";
							
							j.setAttribute('src', url);
							j.setAttribute('type', 'text/javascript');
							
							$("#certTxt > div").text("설치됨");
							$("#certTxt button").prop("disabled", true);
							$("#certTxt button").hide();
							
						}else{
							//console.log("실패 : ");
							setTimeout(UniCRSChecker, 1000);
						}
					}
					setTimeout(fnlogic,200);
				}
				
				var chkImg;
				if (navigator.userAgent.indexOf("MSIE 7.0") !== -1) {
					chkImg = document.createElement("<img id='uniImg' alt='uniImg' src='"+unicrsSrc + '/CRS?cd=' + Math.random() + "' onload='fnResult2(this, true)' onerror='fnResult2(this, false)' />");
					chkImg.onerror = function() {fnResult2(chkImg, false);};
					chkImg.onload = function() {fnResult2(chkImg, true);};
					chkImg.style.display = "none";
				} else {
					//여기
					chkImg = document.createElement('img');
					
					chkImg.setAttribute('id', "uniImg");
					chkImg.setAttribute('src', unicrsSrc + '/CRS?cd=' + Math.random());
					chkImg.onerror = function() {fnResult2(chkImg, false);};
					chkImg.onload = function() {fnResult2(chkImg, true);};
					chkImg.style.display = "none";
				}
				
				document.body.appendChild(chkImg);
				
			}
			
			
			// ############ 공인증서 설치 부분 끝 ######################################//
			
			// ############ 마크애니 설치 부분 시작 ######################################//
			//설치체크파일정보		[version			, CSIDL		, exeName						, addPath				];
			var checkFileInfo_1 = 	[ "25043"		, 0x0026	, "TWFFUFNCcm9rZXIuZXhl"	, "c0f3ryzZBcTnc1jNceBfFXI=" ];
			//var checkFileInfo_2 = 	[ "2505"			, 0x0029	, "0veef5ygDSRZ4RMLoCROIGxs"	, "" ];
			//var chkFileArray = new Array(checkFileInfo_1, checkFileInfo_2);
			var chkFileArray = new Array(checkFileInfo_1);
			
			var programComment_1 = [ "MaEPSBroker"	, "XP, Vista, 7, 8, 8.1, 10"	, "설치체크 프로그램입니다. 해당 프로그램이 미설치 시 아래의 프로그램에 대한 설치체크를 진행 할 수 없습니다."			, "/markany/install/Setup_NoaXOZ.exe"];
			//var programComment_2 = [ "ePageSafer"	, "XP, Vista, 7, 8, 8.1, 10"	, "출력물 위변조방지를 위한 프로그램 입니다."	, "./bin/Setup_NoaXOZ.exe" ];
			//var programCommentArray = new Array(programComment_1, programComment_2);
			var programCommentArray = new Array(programComment_1);		
			
			//마크애니 설치 확인
			var chk = 0;
			function maEPS_InstallCheck() {
				MDBG("", "start");
				console.log("maEPS_InstallCheck : " + maOnlyInstallFlag);
				console.log("maEPS_InstallCheck : " + typeof (maResJsonData) );
				//if (maOnlyInstallFlag == true) chk ++;
				
				if (typeof (maResJsonData) !== 'string') {
					var installFlag = maResJsonData[0].installFlag;			
					
					console.log("maEPS_InstallCheck installFlag: " + installFlag);
				}else{
					
					console.log("maEPS_InstallCheck 1: ");
					MDBG("", maResJsonData);
				}
				
				if (maOnlyInstallFlag == true) {
					
					//alert("설치가 완료되었습니다.");
					$("#waitOverlay").hide();
					
					$("#markTxt > div").text("설치됨");
					$("#markTxt button").prop("disabled", true);
					$("#markTxt button").hide();	
					
					clearTimeout(fnMarkInsChk);
				}else{
					chk++;
					if(chk > 10){
						top.document.location.href = "/";
					}else{
						setTimeout(fnMarkInsChk, 5000);
					}
					
				}
					
			}
			
			//마크애니설치호출
			var fnReInstallMark = function(){
				$("#waitOverlay").show();
				document.getElementById("downfrm").src = "/markany/install/Setup_NoaXOZ.exe";
				maBrokerInit( maEPS_InstallCheck, 'getVersion', true );
			}
			
			//마크애니설치완료체크
			var fnMarkInsChk = function(){
				maBrokerInit( maEPS_InstallCheck, 'getVersion', true );
			}
			
			// ############ 마크애니 설치 부분 끝 ######################################//
			
			//오즈 부분
			var OZUtil = start_OZUtil;
			var namespace = "kocfcExeViewer";
			var OZViewerID = "OZViewer";
			var OZInstallChk = false;
			OZUtil.CloseEXEViewer(OZViewerID);
			OZCall = function()
			{
				var	protocolversion = 2008;
				var ztParam = new Object();
			    ztParam.InstallBase = "<PROGRAMS>/Forcs";
			    ztParam.InstallNamespace = namespace;
			    ztParam.DownloadServer = "http://www.kocfc.or.kr/oz80/ozexeviewer/ozrviewer";
			    ztParam.DownloadPort = 80;
			    ztParam.DownloadInstruction = "ozrviewer.idf";
				OZUtil.installViewer(protocolversion, ztParam, installOZWebLauncher, createOZViewer);
			}
			
			
			installOZWebLauncher = function()
			{
				if(OZInstallChk == false){
					OZInstallChk = true;
			    	setTimeout(function(){ OZCall(); }, 2000);
			    	
					//document.getElementById('downfrm').src = '/oz80/OnLine_Install_Dialog_UI_SSL.exe';
			    	document.getElementById('downfrm').src = '/oz80/OnLine_Install_Dialog_UI_SSL.exe';
				}else{ //1차 설치 중일 경우
					setTimeout(function(){ OZCall(); }, 2000);
				}
			}
			
			createOZViewer = function()
			{
				$("#ozTxt > div").text("설치됨");
				$("#ozTxt button").prop("disabled", true);
				$("#ozTxt button").hide();	
				
			}
			
			//오즈설치호출
			var fnReInstallOz = function(){
				$("#ozTxt > div").text('설치');
				$("#waitOverlay").show();
				OZCall();
			}
			
			/***************************************************/
			
			
			
			/*]]>*/
		</script>
		<form name="chkFrm" id="chkFrm" onSubmit="return false;" method="post">
			<input type="hidden" name="chkVals" id="chkVals"  />
		</form>
		<div class="content-wrap">
            <div class="inner">
                <div class="content-box flex-box jc-between">
                    <!-- 업무 안내 영역 -->
                    

                    <!-- 업무 안내 영역 끝 -->
                    <div class="content-main">
						<!-- 경로 영역 시작 -->
                        <!-- 경로 영역 끝 -->
                        <form name="saveFrm" id="saveFrm" onSubmit="return false;">
                        <section id="content" class="content">
                            <!-- 여기서부터 content -->
                            <div>
								<div id="" style="padding: 50px; box-sizing:border-box">
                                    <p class="title-dept1 m-mb0">필수 설치 프로그램 안내</p>
                                    <p class="txt-dept1">
										홈페이지 > 로그인 페이지 내에서 자동으로 프로그램 설치 유무를 확인하여 설치 진행을 지원하고 있습니다.
										</br>다음은 설치가 정상적으로 처리 되지 않을 경우에 대한 처리 방법 입니다.
									</p>
                                    <ul>
                                        <li class="dot-dept1">업무 관련 프로그램</li>
                                        <li class="txt-dept2">1. 공인인증서(CROSSCERT)</li>
                                        <li class="txt-dept2">2. 레포트(출력물) 위변조 프로그램(MarkAny)</li>
                                        <li class="txt-dept2">3. 레포트(출력물) 오즈레포트(OZReport)</li>
                                    </ul>
                                    <div class="alignR mt20" style="display: flex; justify-content: space-between; align-items: flex-end;">
										<span style="font-size: 15px; color: #ff6600;" class="fl">* 미설치된 프로그램이 있습니다. 우측상단 다운로드 버튼을 클릭하여 프로그램을 다운로드 해주세요.</span>
									</div>
                                    <article class="table-wrap">
                                        <div class="table-scroll">
                                            <table>
                                                <caption>필수 설치 프로그램 안내</caption>
                                                <colgroup>
                                                    <col style="width: 20%;">
                                                    <col style="width: 50%;">
                                                    <col style="width: 20%;">
                                                </colgroup>
                                                <thead>
                                                    <tr class="back-gray">
                                                        <th scope="col">종류</th>
                                                        <th scope="col">내용</th>
                                                        <th scope="col">설치상태</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td class="txt-center">공인인증서(CROSSCERT)</td>
                                                        <td>인증서 이동을 위한 응용프로그램.</td>
                                                        <td id="certTxt" class="txt-center">
															<div></div>
															<button type="button" class="sub-btn btn-color red" style="display: none; font-size: 14px;" onclick="fnReInstallCert();" disabled>설치하기</button></td>
														</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="txt-center">MarkAny</td>
                                                        <td>레포트(출력물) 위변조 프로그램(MarkAny).</td>
                                                        <td id="markTxt" class="txt-center">
															<div></div>
															<button type="button" class="sub-btn btn-color red" style="display: none; font-size: 14px;" onclick="fnReInstallMark();" disabled>설치하기</button></td>
														</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="txt-center">오즈레포트</td>
                                                        <td>레포트(출력물) 오즈레포트(OZReport).</td>
                                                        <td id="ozTxt" class="txt-center">
															<div></div>
															<button type="button" class="sub-btn btn-color red" style="display: none; font-size: 14px;" onclick="fnReInstallOz();" disabled>설치하기</button></td>
														</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </article>
                                    <article>
										<p class="title-dept1 m-mb0 mt20">문의 사항</p>
	                                    <p class="txt-dept1">
											02-3661-5384 동양정보서비스 전산운영팀
											<!--
											</br>원격 접속정보 : https://939.co.kr/dongyangis
											-->
										</p>
									</article>
									<span style="font-size: 18px; color: #ff6600;" class="mt20">* 설치가 완료되면 아래 "설치완료" 버튼을 눌러 로그인페이지로 이동하여 다시 로그인하여 주십시오.</span>
                                </div>
								
                        	</div>
                        </section>
                        <div class="btn-wrap">
                            <button id="" type="button" class="sub-btn2 btn-color blue" onclick="location.href='/main.do'">설치완료</button>
                        </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <iframe id="downfrm" style="display:none;" title="오즈설치용"></iframe> <!-- 오즈설치용 -->
        
        <div id="waitOverlay" style="display: none;">
			<div>
				<img src="/images/loading.gif" onerror="" alt="로딩바"/>
				<span>잠시만 기다려주세요, 필요한 프로그램을 설치중입니다.</br>시간이 다소 소요될 수 있습니다...</span>
			</div>
		</div>
	</body>

</html>