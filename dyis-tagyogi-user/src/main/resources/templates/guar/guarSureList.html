<!--
	시스템구분 : 홈페이지 
	파일정보 : guarSureList.html
	파일명 : guarSureList.html
	업무명 : 연대보증입보동의현황
	생성자 : 변성균
	생성일 : 2023.08.11
-->
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xml:lang="ko">
	
	<script th:inline="javascript">
		/*<![CDATA[*/
		var codeList = /*[[${codeList}]]*/ //공통코드
		
		//화면 초기화 처리 호출
		$(document).ready(function(){
			//lnb 세팅함수
			fnPageLnbSet(/*[[${menuInfo}]]*/); //lnb세팅
			
			com.fnCodeSelectBox("CM08", "sSureCd", 1, ""); //보증인구분
			
		});
		
		var fnSerch = function(){
			if($("#sSureCd").val() === "10" || $("#sSureCd").val() === "20" ){
				valChks = ["sSureCd", "sSerchVal", "sSureNm"];
			}
			if($("#sSureCd").val() === "30"|| $("#sSureCd").val() === "40"){
				valChks = ["sSureCd", "sSerchVal"];
			}
			if(com.fnValChk(valChks)){
				obj = {url:"/guarSure/selectGuarSureList.do", formId:"serchFrm", callBack:fnSerchCallBack, msgYn:"N", sessYn:"N", loadYn:"Y"};
				com.fnAjaxPost(obj);
			}
			
		}
		
		var fnSerchCallBack = function(resData){
			
			if(resData.data.length === 0) $("#ele_sureList").append('<tr><td colspan=7">정보가 없습니다.</td></tr>');
			
	
			$.each(resData.data, function(index, item) {
				var html  = '<tr>';
					html += '<td class="alignC">'+ Number(index + 1)  + '</td>'; //순번
					html += '<td class="alignC">'+ item.contrNm + '</td>'; //약정인 
					html += '<td class="alignC">'+ item.sureCdNm + '</td>'; //구분
					html += '<td class="alignC">'+ item.sureNm +'</td>'; //보증인
					html += '<td class="alignC">'+ item.sureRelation +'</td>'; //관계
					html += '<td class="alignC">'+ item.mortTypeNm +'</td>'; //보증인요건
					html += '<td class="alignC">'+ item.contrStatNm +'</td>'; //약정처리상태
					if(item.agreeYn === "Y"){
						html += '<td class="alignC">완료</td>'; //동의여부
					}else{
						html += '<td class="alignC"><button type="button" class="btn-color sub-btn small"><a href="javascript:fnSign(\''+item.contrNo+'\',\''+item.sureCd+'\',\''+item.sureSeq+'\',\''+item.membDiv+'\');">서명</a></button></td>'; //동의여부
					}
					html += '</tr>';
					
				$("#ele_sureList").append(html);
			});
		}
		
		//보증인구분 변경
		var fnSureCdChg = function(obj){
			//10 대표자, 20 개인 , 30 법인 , 40 조합원
			var type = obj.value;
			
			$("#sSerchVal").val("6509271813514");
			$("#sSureNm").val("김제구");
			$("#ele_sureTitl").css("display", "none");
			$("#ele_sureNm").css("display", "none");
			
			if(type !== "") $("#ele_serchTd").css("display", "");
			
			if(type === "10" || type === "20"){
				$("#ele_title").text("주민등록번호");	
				$("#ele_sureTitl").css("display", "");
				$("#ele_sureNm").css("display", "");
			}else if(type === "30"){
				$("#ele_title").text("사업자번호");
			}else if(type === "40"){
				$("#ele_title").text("조합원번호");
			}else{
				$("#ele_serchTd").css("display", "none");
				$("#ele_title").text("");
			}
			
			
		}
		
		//서명 이동
		var fnSign = function(contrNo, sureCd, sureSeq, membDiv){
			var param = {contrNo: contrNo, sureCd: sureCd, sureSeq: sureSeq, membDiv:membDiv, returnPage: /*[[${menuInfo.menuCd}]]*/};
			fnPage("2030509", param);	
		}
		/*]]>*/
	</script>
        <div class="main-top sub">
			<ul class="inner">
                <li class="move1"></li>
                <li class="move2"></li>
                <li class="move3"></li>
                <li class="move4"></li>
                <li class="move5"></li>
            </ul>
        </div>
        <div class="content-wrap">
            <div class="inner">
                <div class="content-box flex-box jc-between">
                    <!-- 업무 안내 영역 -->
                    <div id="lnb" class="lnb-wrap">
                        <h3 class="ko-bold h3-txt"></h3>
                        
                    </div>

                    <!-- 업무 안내 영역 끝 -->
                    <div class="content-main">
						<!-- 경로 영역 시작 -->
                        <div th:insert="~{/fragments/subTitle}"></div>
                        <!-- 경로 영역 끝 -->
                        <form name="serchFrm" id="serchFrm" onSubmit="return false">
						<input type="hidden" th:name="_csrf" th:value="${_csrf?.token}"/>
                        <section id="content" class="content">
                            <!-- 여기서부터 content -->
                            <div>
                                <article>
                                    <form action="serchFrm" method="post" name="search">
										<input type="hidden" th:name="_csrf" th:value="${_csrf?.token}"/>
										<div class="search-wrap txt-border-wrap">
                                            <table class="block">
                                                <colgroup>
                                                    <col width="10%">
                                                    <col width="13%">
                                                    <col width="10%">
                                                	<col width="15%">
                                                    <col width="10%">
                                                	<col width="*">
                                                </colgroup>
                                                <tbody>
													<tr>
                                                        <th>보증인구분</th>
                                                        <td>
                                                            <div class="flex-box al-center gap-10">
                                                                <select name="sSureCd" id="sSureCd" width="120px" onchange="fnSureCdChg(this);"></select>
                                                            </div>
                                                            <div id="ele_dateDt" class="ele_dt"></div>
                                                        </td>
                                                        <th><span id="ele_title"></span></th>
                                                        <td id="ele_serchTd" style="display:none">
															<input type="text" name="sSerchVal" id="sSerchVal" title="관련번호" onkeyup="com.fnOnlyNum(this);" maxlength="13" style="width:140px" value="" />
                                                        </td>
                                                        <th id="ele_sureTitl" style="display:none">보증인명</th>
                                                        <td id="ele_sureNm" style="display:none">
															<input type="text" name="sSureNm" id="sSureNm" title="보증인명" maxlength="20" style="width:120px" value="" />
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                            <div class="alignR btn-position">
												<button class="sub-btn btn-black m-w-100" onClick="fnSerch()">검색</button>
											</div>
                                        </div>
                                    </form>
                                </article>
                                <article>
                                    <div class="table-wrap board">
                                        <div class="table-scroll v2">
                                            <table class="border">
                                                <thead class="back-gray">
                                                    <tr>
                                                        <th width="5%" scope="col">순번</th>
                                                        <th width="15%" scope="col">약정인</th>
                                                        <th width="8%" scope="col">구분</th>
                                                        <th width="10%" scope="col">보증인</th>
                                                        <th width="8%" scope="col">관계</th>
                                                        <th width="14%" scope="col">보증인요건</th>
                                                        <th width="10%" scope="col">약정처리상태</th>
                                                        <th width="10%" scope="col">동의여부</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="ele_sureList"></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </article>
                                
                            </div>
                        </section>
                        </form>
                    </div>
                </div>
            </div>
        </div>
</html>