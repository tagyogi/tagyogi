<!--
	시스템구분 : 홈페이지
	파일정보 : guarContrSubIns
	파일명 : guarContrSubIns
	업무명 : 사이버보증 - 보증약정제출등록 화면
	생성자 : 변성균
	생성일 : 2023.08.29
-->
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xml:lang="ko">
	
	<script th:inline="javascript">
		/*<![CDATA[*/
		var codeList = /*[[${codeList}]]*/ //공통코드
		var paramMap = /*[[${paramMap}]]*/ 
		var contrInfo = ""; //약정정보
		
		//화면 초기화 처리 호출
		$(document).ready(function(){
			//lnb 세팅함수
			fnPageLnbSet(/*[[${menuInfo}]]*/, "보증약정신청현황"); //lnb세팅
			
			//약정정보 호출
			param = {contrNo:paramMap.contrNo};
			obj = {url:"/guarContr/selectGuarContr.do", param:param, callBack:fnSerchCallBack, msgYn:"N", sessYn:"Y", loadYn:"Y"};
			com.fnAjaxDef(obj);	
			
		});
		
		//조회콜백
		var fnSerchCallBack = function(resData){
			//console.log(resData);
			contrInfo = resData.data;
			com.fnSetKeyVal(resData.data);
		}
		
		//약관보기
		var fnClauPop = function(){
			window.open("/index/popPageCall.do?menuPage=guar/comClauPop", "약관", "width=700,height=600,top=100, scrollbars=yes, resizable=yes");
		}
		
		//제출처리
		var fnSave = function(){
			
			
			if(confirm("보증약정 신청정보를 제출하시겠습니까?")){
				var membNm = /*[[${session.membNm}]]*/;
					
				let plan = "신청일자 : "		+ contrInfo.reqDt.replace(/\-/g,'') + "\n" +
							"신청자 : " 		+ contrInfo.reqNm + "\n" +
							"신청전화번호 : "	+ contrInfo.reqTelNo + "\n" +
							"조합원명 : "		+ membNm + "\n\n" +
							"약정구분 : "		+ $("#ele_contrTypeNm").text() + "\n" +
							"약정기간 : "		+ $("#ele_contrTermDt").text() + "\n" +
							"약정좌수 : "		+ $("#ele_contrNum").text() + "\n" +
							"약정금액 : "		+ $("#ele_sumLimitAmt").text() + "\n" 
							;
				//alert(plan);
				param = {plan:plan, idn:/*[[${session.bizNo}]]*/};
				com.fnCertSign(param); //전자서명 처리
			}		
		}
		
		//서명 콜백
		var fnCertSingCallBack = function(resData){
			//console.log(resData);
			$("#signData").val(resData.signData);
			
			var param = $("#saveFrm").serializeObject();
			obj = {url:"/guarContr/updateGuarContrMembReqSubmit.do", callBack:fnSaveCallBack, param:param, msgYn:"Y", sessYn:"Y", loadYn:"Y" };
			com.fnAjaxDef(obj);
		}
		
		
		//저장 콜백
		var fnSaveCallBack = function(resData){
			fnPage('2030108');
		}
		
		/*]]>*/
	</script>
        <div class="main-top sub">
			<ul class="inner">
                <li class="move1"></li>
                <li class="move2"></li>
                <li class="move3"></li>
                <li class="move4"></li>
                <li class="move5"></li>
            </ul>
        </div>
        <div class="content-wrap">
            <div class="inner">
                <div class="content-box flex-box jc-between">
                    <!-- 업무 안내 영역 -->
                    <div id="lnb" class="lnb-wrap">
                        <h3 class="ko-bold h3-txt"></h3>
                        
                    </div>

                    <!-- 업무 안내 영역 끝 -->
                    <div class="content-main">
						<!-- 경로 영역 시작 -->
                        <div th:insert="~{/fragments/subTitle}"></div>
                        <!-- 경로 영역 끝 -->
                        <form name="saveFrm" id="saveFrm" onsubmit="return false;">
						<input type="hidden" th:name="_csrf" th:value="${_csrf?.token}"/>
						<input type="hidden" name="contrNo" id="contrNo" />
						<input type="hidden" name="signData" id="signData" />
						<section id="content" class="content">
                            <!-- 여기서부터 content -->
                           
                                <article>
                                    <p class="title-dept1">조합원정보</p>
                                    <div class="table-wrap info">
                                        <div class="table-scroll">
                                            <table width="100%">
												<colgroup>
                                                    <col width="12%">
                                                    <col width="21%">
                                                    <col width="12%">
                                                    <col width="21%">
                                                    <col width="12%">
                                                	<col width="*">
                                                </colgroup>
                                                <tbody>
                                                    <tr>
                                                        <th >조합원</th>
                                                        <td colspan="3">[[${session.membNm}]]</td>
                                                        <th >대표자</th>
                                                        <td>[[${session.ceoNm}]]</td>
                                                    </tr>
                                                    <tr>
                                                        <th >사업자번호</th>
                                                        <td>[[${session.bizNo}]]</td>
                                                        <th >소속단체</th>
                                                        <td colspan="3">[[${session.belong}]]</td>
                                                    </tr>
                                                    <tr>
                                                        <th >전화번호</th>
                                                        <td>[[${session.telNo}]]</td>
                                                        <th >팩스번호</th>
                                                        <td>[[${session.faxNo}]]</td>
                                                        <th >주장르</th>
                                                        <td>[[${session.mainBussNm}]]</td>
                                                    </tr>
                                                    <tr>
                                                        <th >주소</th>
                                                        <td colspan="5">[[${session.addrFull}]]</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </article>
                                <article>
                                    <p class="title-dept1">약정신청 정보
										<button type="button" class="btn-color green sub-btn"><a href="javascript:fnClauPop();">약관</a></button>
									</p>
                                    <div class="table-wrap info">
                                        <div class="table-scroll">
                                            <table width="100%">
												<colgroup>
                                                    <col width="12%">
                                                    <col width="21%">
                                                    <col width="12%">
                                                	<col width="*">
                                                </colgroup>
                                                <tbody>
                                                    <tr>
                                                        <th>약정구분</th>
                                                        <td><span id="ele_contrTypeNm"></span></td>
                                                        <th>처리상태</th>
                                                        <td><span id="ele_procStatNm"></span></td>
                                                    </tr>
                                                    <tr>
                                                        <th>약정일자</th>
                                                        <td colspan="3">
															<span id="ele_contrDt"></span>
														</td>
                                                    </tr>
                                                    <tr>
                                                        <th>약정기간</th>
                                                        <td colspan="3">
															<span id="ele_contrTermDt"></span>
														</td>
                                                    </tr>
                                                    <tr>
														<th>약정좌수</th>
                                                        <td colspan="3">
															<span id="ele_contrNum"></span>
														</td>
                                                    </tr>
                                                    <tr>
                                                        <th>약정금액</th>
                                                        <td colspan="3">
															<span id="ele_sumLimitAmt"></span>
															<br>※ 약정금액에 신용도에 따른 배수율이 적용되어 약정한도금액이 산정됩니다.
														</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </article>
                                <div class="btn-wrap flex-box jc-center gap-15">
                                    <button type="button" class="btn-color sub-btn2" onclick="fnSave()">신청</button>
                                    <button type="button" class="btn-white sub-btn2" onclick="fnPage('2030108')">목록</button>
                                </div>
                         
                        </section>
                        </form>
                    </div>
                </div>
            </div>
        </div>
</html>