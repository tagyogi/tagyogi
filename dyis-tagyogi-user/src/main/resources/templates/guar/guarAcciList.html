<!--
	시스템구분 : 홈페이지
	파일정보 : guarAcciList.html
	파일명 : guarAcciList.html
	업무명 : 공제금신청현황
	생성자 : 변성균
	생성일 : 2023.08.11
-->
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xml:lang="ko">

	<script th:inline="javascript">
		/*<![CDATA[*/
		var codeList = /*[[${codeList}]]*/ //공통코드
		var acciBizNo = /*[[${paramMap.acciBizNo}]]*/

		//화면 초기화 처리 호출
		$(document).ready(function(){
			//lnb 세팅함수
			fnPageLnbSet(/*[[${menuInfo}]]*/, '공제금신청'); //lnb세팅

			com.fnCodeSelectBox("AC07", "sAccStatCd", 1, ""); //사고상태

			//달력
			//from to
			com.fnDateFromTo("ele_dateDt", "sClaimStaDt", "sClaimEndDt"); //시작~종료 달력
			$("#btn_Dt").click(function(){ com.fnDateCalVisible($("#ele_dateDt"));  }); //달력버튼처리
			$("#sClaimStaDt, #sClaimEndDt").val("");


			if(acciBizNo === "" || acciBizNo === undefined) {
				alert('기관인증이 제대로 처리되지 않았습니다.');
				fnPage('2030503');
				return;
			}else {
				//alert('기관사업자번호 넘어옴');
			}

			//조회
			fnSerch();
		});

		var fnSerch = function(){

			obj = {url:"/acciGuar/selectAcciGuarList.do", formId:"serchFrm", callBack:fnSerchCallBack, msgYn:"N", sessYn:"N", loadYn:"Y"};
			com.fnAjaxPost(obj);

		}

		var fnSerchCallBack = function(resData){
			//console.log(resData);

			//피공제자, 사업자번호 상단부분 세팅
			$("#setBizNo").text($("#sOrderBizNo").val());

			$("#ele_accStatList").empty();

			let totCnt = resData.data.length;
			if(totCnt === 0) $("#ele_accStatList").append('<tr><td colspan=8">정보가 없습니다.</td></tr>');

			$.each(resData.data, function(index, item) {
				let html  = '<tr onclick="fnView(\''+item.accNo+'\',\''+item.accStatCd+'\')" style="cursor: pointer;">';
					html += '<td class="alignC">'+ totCnt  + '</td>'; //번호
					html += '<td class="alignC">'+ com.fnNvlChk(item.claimDtVal) + '</td>'; //청구일자
					html += '<td class="alignL">'+ com.fnNvlChk(item.membNm) + '</td>'; //조합원명
					html += '<td class="alignL">'+ com.fnNvlChk(item.servNm) +'</td>'; //계약건명
					html += '<td class="alignL">'+ com.fnNvlChk(item.guarTermDt) +'</td>'; //보증기간
					html += '<td class="alignR setCommaCls">'+ com.fnNvlChk(item.guarAmt) +'</td>'; //보증금액
					html += '<td class="alignR setCommaCls">'+ com.fnNvlChk(item.claimAmt) +'</td>'; //청구금액
					html += '<td class="alignL">'+ com.fnNvlChk(item.accStatCdNm) +'</td>'; //처리상태

				totCnt--;
				$("#ele_accStatList").append(html);
			});

			//콤마추가 클래스들 세팅
			$.each($(".setCommaCls"), function(idx,item){
				$(item).text($(item).text() === null ? "0":com.addComma($(item).text()));
			});

		}

		//상세호출
		var fnView = function(accNo,statCd){
			$("#accNo").val('');
			$("#accNo").val(accNo);
			$("#accStat").val('');
			$("#accStat").val(statCd);

			var param = {};
			param.accNo = accNo;
			param.accStat = statCd;
			param.acciBizNo = acciBizNo;
			//console.log(param);

			fnPage('2030507', param);

		}

		//신청페이지 호출
		var fnReq = function(){
			var param = {};
			param.acciBizNo = $("#sOrderBizNo").val();
			fnPage('2030505', param);
		}


		/*]]>*/
	</script>
        <div class="main-top sub">
			<ul class="inner">
                <li class="move1"></li>
                <li class="move2"></li>
                <li class="move3"></li>
                <li class="move4"></li>
                <li class="move5"></li>
            </ul>
        </div>
        <div class="content-wrap">
            <div class="inner">
                <div class="content-box flex-box jc-between">
                    <!-- 업무 안내 영역 -->
                    <div id="lnb" class="lnb-wrap">
                        <h3 class="ko-bold h3-txt"></h3>

                    </div>

                    <!-- 업무 안내 영역 끝 -->
                    <div class="content-main">
						<!-- 경로 영역 시작 -->
                        <div th:insert="~{/fragments/subTitle}"></div>
                        <!-- 경로 영역 끝 -->
                        <form name="serchFrm" id="serchFrm" onSubmit="return false">
						<input type="hidden" th:name="_csrf" th:value="${_csrf?.token}"/>
						<input type="hidden" name="signedCont" id="signedCont" value=""/>
						<input type="hidden" name="accNo" id="accNo" value=""/>
						<input type="hidden" name="accStat" id="accStat" value=""/>
						<input type="hidden" name="sOrderBizNo" id="sOrderBizNo" th:value="${paramMap.acciBizNo}">
                        <section id="content" class="content">
                            <!-- 여기서부터 content -->
                            <div>
                                <article>
                                    <form action="" method="get" name="search">
										<input type="hidden" th:name="_csrf" th:value="${_csrf?.token}"/>
										<div class="search-wrap txt-border-wrap">
                                            <table class="block">
                                                <colgroup>
                                                    <col width="10%">
                                                    <col width="35%">
                                                    <col width="10%">
                                                    <col width="20%">
                                                    <col width="10%">
                                                	<col width="*">
                                                </colgroup>
                                                <tbody>
													<tr>
                                                        <th id="txt_serchDt">신청일자</th>
                                                        <td>
                                                            <div class="flex-box al-center gap-10">
                                                                <div class="flex-box al-center">
                                                                    <input type="text" name="sClaimStaDt" id="sClaimStaDt" value="" class="w-100" title="시작일 입력" placeholder="YYYY-MM-DD" maxlength="10" onkeyup="com.fnOnlyNum(this);com.fnDateMakeForm(this)" onblur="com.fnDateValiChk(this);" autocomplete="off"/>
                                                            		<img src="../images/icon_calendar.png" alt="달력" class="calendar-box" onclick="calendar(this, 'sClaimStaDt', 'yyyy-mm-dd','sClaimEndDt', 1)" />
                                                                </div>
                                                                ~
                                                                <div class="flex-box al-center">
                                                                    <input type="text" name="sClaimEndDt" id="sClaimEndDt" value="" class="w-100" title="종료일 입력" placeholder="YYYY-MM-DD" maxlength="10" onkeyup="com.fnOnlyNum(this);com.fnDateMakeForm(this)" onblur="com.fnDateValiChk(this);" autocomplete="off"/>
                                                            		<img src="../images/icon_calendar.png" alt="달력" class="calendar-box" onclick="calendar(this, 'sClaimEndDt', 'yyyy-mm-dd','sClaimStaDt', 2)" />
                                                                </div>
                                                            </div>
                                                        </td>
                                                        <th class="ko-bold">처리상태</th>
                                                        <td>
															<select name="sAccStatCd" id="sAccStatCd" class=" w-100"></select>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                            <div class="alignR btn-position">
												<button class="sub-btn btn-black m-w-100" onclick="fnSerch()">검색</button>
												<button class="sub-btn btn-color blue m-w-100 fr" onClick="fnReq()">신청</button>
											</div>
                                        </div>
                                    </form>
                                </article>

                                <!--목록-->
                                <article>
									<div class="mb10">
										<!--<span class="ko-bold ml15">사업자번호 : <em id="setBizNo"></em></span>-->
									</div>
                                    <div class="table-wrap board">
                                        <div class="table-scroll v2">
                                            <table class="border">
                                               	<colgroup>
	                                                <col style="width:4%">
	                                                <col style="width:10%">
	                                                <col style="width:18%">
	                                                <col style="width:auto">
	                                                <col style="width:15%">
	                                                <col style="width:10%">
	                                                <col style="width:10%">
	                                                <col style="width:8%">
	                                            </colgroup>
                                                <thead class="back-gray">
                                                    <tr>
                                                        <th scope="col">순번</th>
                                                        <th scope="col">청구일자</th>
                                                        <th scope="col">조합원명</th>
                                                        <th scope="col">계약건명</th>
                                                        <th scope="col">보증기간</th>
                                                        <th scope="col">보증금액</th>
                                                        <th scope="col">청구금액</th>
                                                        <th scope="col">처리상태</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="ele_accStatList"></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </article>
                            </div>
                        </section>
                        </form>
                    </div>
                </div>
            </div>
        </div>
</html>