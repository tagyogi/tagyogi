<!--
	시스템구분 : 홈페이지 
	파일정보 : guarPayDtl.html
	파일명 : guarPayDtl.html
	업무명 : 보증료 결제 화면
	생성자 : 변성균
	생성일 : 2023.09.12
-->
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xml:lang="ko">
	
	
	<script th:inline="javascript">
		/*<![CDATA[*/
		//세션끊김방지
		document.cookie = "safeCookie1=foo; SameSite=Lax"; 
	    document.cookie = "safeCookie2=foo"; 
	    document.cookie = "crossCookie=bar; SameSite=None; Secure";
	    
		var codeList = /*[[${codeList}]]*/ //공통코드
		
		//화면 초기화 처리 호출
		$(document).ready(function(){
			//lnb 세팅함수
			fnPageLnbSet(/*[[${menuInfo}]]*/, /*[[${paramMap.listNm}]]*/); //lnb세팅

			com.fnCodeSelectBox("GR01", "sGuarType", 1, ""); //보증상품
			com.fnCodeSelectBox("CM01", "sPayWay", 1, ""); //결제방법
			
			
			//조합 계좌정보 
			let accInfo = "";
			let accCnt = 1;
			kocfcAccList.forEach((item, idx) => {
				if(item.bankType === "보증료"){
					accInfo += accCnt + ") "+item.bankNm+" " + item.acctNo + " </br>";
					accCnt ++;
				}
		  	});
		  	$("#accInfo").html(accInfo);
		  	
		  	var guarCont = /*[[${paramMap.guarCont}]]*/
		  	var remainCommAmt = /*[[${paramMap.remainCommAmt}]]*/
		  	
		  	$("#ele_payCont").text(guarCont + " 보증료");
		  	$("#ele_payAmt").text(com.aprojomma(remainCommAmt));
		});
		
		
		//결제 처리
		var fnPayProc = function(){
			if(com.fnSessChk()){
				var payWayChk = $('input[name="payWay"]:checked').val();
				if(payWayChk === undefined || payWayChk === "A"){ //뱅크페이
					$("#hd_item_name").val($("#ele_payCont").text());
					$("#tx_amount").val(/*[[${paramMap.remainCommAmt}]]*/);
					$("#tx_guarNoArr").val(/*[[${paramMap.guarNo}]]*/);
					
					com.fnAction("/pay/bankPayReq.do", payFrm, "payFrame");
					
				}else if(payWayChk === "C"){ //이니시스
					$("#price").val(/*[[${paramMap.remainCommAmt}]]*/);
					$("#goodname").val($("#ele_payCont").text());
					$("#buyername").val(/*[[${session.membNm}]]*/);
					$("#buyertel").val(/*[[${session.telNo}]]*/);
					$("#buyeremail").val(/*[[${session.compEmail}]]*/);
					$("#guarNoArr").val(/*[[${paramMap.guarNo}]]*/);
					
					var options = "top=300, height=600,width=820,status=no,dependent=no,scrollbars=no,resizable=no";
					com.popupOpen("/pay/iniPayReq.do", "iniPayPop", options, document.payIniFrm); 
					
				}else{
					alert("결제방법이 선택 되지 않았습니다. 관리자에게 문의하시기 바랍니다.");
					return;	
				}
			}
			
		}
		
		//목록으로
		var fnRepage = function(){
			var param = {};
			fnPage(/*[[${paramMap.returnPage}]]*/, param);
		}
			
		
		/*]]>*/
	</script>
        <div class="main-top sub">
			<ul class="inner">
                <li class="move1"></li>
                <li class="move2"></li>
                <li class="move3"></li>
                <li class="move4"></li>
                <li class="move5"></li>
            </ul>
        </div>
        <div class="content-wrap">
            <div class="inner">
                <div class="content-box flex-box jc-between">
                    <!-- 업무 안내 영역 -->
                    <div id="lnb" class="lnb-wrap">
                        <h3 class="ko-bold h3-txt"></h3>
                        
                    </div>

                    <!-- 업무 안내 영역 끝 -->
                    <div class="content-main">
						<!-- 경로 영역 시작 -->
                        <div th:insert="~{/fragments/subTitle}"></div>
                        <!-- 경로 영역 끝 -->
                        
                        <form name="payFrm" id="payFrm" method="post" onSubmit="return false" accept-charset="euc-kr">
						<input type="hidden" th:name="_csrf" th:value="${_csrf?.token}"/>
						<!-- 뱅크페이 관렴 변수 -->
						<input type="hidden" name="hd_item_name" id="hd_item_name" /> <!-- 뱅크페이 item -->
						<input type="hidden" name="tx_amount" id="tx_amount" /> <!-- 뱅크페이 금액 -->
						<input type="hidden" name="tx_guarNoArr"    id="tx_guarNoArr"     	value="" />  <!--보증번호-->
						</form>
                        <!-- 뱅크페이 관렴 변수  -->
						
						<!-- 이니시스 관렴 변수 끝  -->
						<form name="payIniFrm" id="payIniFrm" method="post" >
						<input type="hidden" th:name="_csrf" th:value="${_csrf?.token}"/>
						<!-- ***************************기본 옵션*************************** -->
		                <input type="hidden" name="price"     		id="price"     			value="" /> <!-- 결재금액 -->
		                <input type="hidden" name="goodname"     	id="goodname"     		value="" /> <!-- 상품명 -->
		                <input type="hidden" name="buyername"     	id="buyername"     		value="" /> <!-- 구매자명 -->
		                <input type="hidden" name="buyertel"     	id="buyertel"     		value="" /> <!-- 구매자 모바일번호 -->
		                <input type="hidden" name="buyeremail"     	id="buyeremail"     	value="" /> <!-- 구매자 이메일 -->
		                
		                <!-- ***************************선택옵션*************************** -->
		                <input type="hidden" name="guarNoArr"    id="guarNoArr"     	value="" /> <!--보증번호-->
		                </form>
						<!-- 이니시스 관렴 변수 끝  -->
						
                        <section id="content" class="content">
                            <!-- 여기서부터 content -->
                            <div>
                                <article>
                                    <p class="title-dept1">조합원정보</p>
                                    <div class="table-wrap info">
                                        <div class="table-scroll">
                                            <table>
                                                <caption>조합원정보</caption>
                                                <colgroup>
                                                    <col width="12%">
                                                    <col width="18%">
                                                    <col width="12%">
                                                    <col width="18%">
                                                    <col width="12%">
                                                    <col width="*">
                                                </colgroup>
                                                <tbody>
													<tr>
                                                        <th >조합원명</th>
                                                        <td colspan="3">[[${session.membNm}]]</td>
                                                        <th>주대표자</th>
                                                        <td>[[${session.ceoNm}]]</td>
                                                    </tr>	
                                                    <tr>
                                                        <th >주소</th>
                                                        <td colspan="3">[[${session.addrFull}]]</td>
                                                        <th>연락처</th>
                                                        <td>[[${session.telNo}]]</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </article>
                                <article>
                                    <p class="title-dept1">결제내용</p>
                                    <div class="table-wrap info">
                                        <div class="table-scroll">
                                            <table>
                                                <caption>결제내용</caption>
                                                <colgroup>
                                                    <col width="12%">
                                                    <col width="18%">
                                                    <col width="12%">
                                                    <col width="18%">
                                                    <col width="12%">
                                                    <col width="*">
                                                </colgroup>
                                                <tbody>
													<tr>
                                                        <th>결제자</th>
                                                        <td colspan="5">[[${session.membNm}]]</td>
                                                    </tr>	
                                                    <tr>
                                                        <th>결제내용</th>
                                                        <td colspan="2"><span id="ele_payCont"></span></td>
                                                        <th>결제금액</th>
                                                        <td colspan="2"><span id="ele_payAmt"></span></td>
                                                    </tr>
                                                    <tr>
                                                        <th>납부정보</th>
                                                        <td colspan="5">
															※ 보증료 납입은 홈페이지 결제 또는 무통장입금으로 진행하시면 됩니다.<br>
															<span id="accInfo"></span>
														</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </article>
                                <th:block th:if="${#strings.equals(session.cardYn, 'Y')}"> <!-- 카드 결제 가능 대상 -->
									<article>
	                                    <p class="title-dept1">결제</p>
	                                    <div class="table-wrap info">
	                                        <div class="table-scroll">
	                                            <table>
	                                                <caption>결제</caption>
	                                                <colgroup>
	                                                    <col width="12%">
	                                                    <col width="18%">
	                                                    <col width="12%">
	                                                    <col width="18%">
	                                                    <col width="12%">
	                                                    <col width="*">
	                                                </colgroup>
	                                                <tbody>
														<tr>
	                                                        <th >결제구분</th>
	                                                        <td colspan="">
																<input type="radio" name="payWay" id="payWay" value="A" checked="checked" > 계좌 결제 
							            						<input type="radio" name="payWay" id="payWay" value="C" /> 카드 결제 
															</td>
	                                                    </tr>	
	                                                </tbody>
	                                            </table>
	                                        </div>
	                                    </div> 
	                                </article>
								</th:block>
								<th:block th:if="${!#strings.equals(session.cardYn, 'Y')}"> <!-- 카드 결제 가능 대상 -->
									<input type="hidden" name="payWay" id="payWay" value="A">
								</th:block>
                                
                                <div class="btn-wrap flex-box jc-center gap-15">
								   <button type="button" class="btn-color red sub-btn2" onclick="fnPayProc();">결제</button>
								   <button type="button" class="btn-white sub-btn2" onclick="fnRepage();">목록</button>
							   </div> 
                                
                            </div>
                        </section>
                        
                        
                    </div>
                </div>
            </div>
        </div>
        <DIV style="display:none; float:left;">
			<IFRAME id=payFrame name=payFrame height="200" width="1000" title="결제용"></IFRAME> <!-- 뱅크페이 -->
		</DIV>
</html>