<!--
	시스템구분 : 홈페이지 (콘텐츠 화면 처리 영역)
	파일정보 : invtReqIns.html
	파일명 : invtReqIns.html
	업무명 : 홈페이지 (콘텐츠 화면 처리 영역)
	생성자 : 변성균
	생성일 : 2023.06.21
-->
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xml:lang="ko">
	
	<script th:inline="javascript">
		/*<![CDATA[*/
		
		//화면 초기화 처리 호출
		$(document).ready(function(){
			//lnb 세팅함수
			fnPageLnbSet(/*[[${menuInfo}]]*/, "추가출자신청 현황"); //lnb세팅
			
			//조합원정보 부르기
			fnInvtDtl();
		});
		
		//추가출자 상세
		var fnInvtDtl = function(){
			param = {};
			obj = {url:"/invtReq/selectInvtReq.do", param:param, formId:"invtIns", callBack:fnInvtDtlcallback, msgYn:"N", sessYn:"N", loadYn:"N"};
			com.fnAjaxPost(obj); 
		}
		
		//추가출자 상세 리턴
		var fnInvtDtlcallback = function(resData){
			console.log(resData.memb);
			console.log(resData.invt);
		
			//상세화면 변수값 세팅, 내용 추가
			com.fnSetKeyVal(resData.memb, "membInfo"); //조합원정보
			$("#insBtn, #bank").removeClass('hide');//신청버튼 보임
			$(".upt").removeClass('hide');
			if(resData.invt !== null && resData.invt !== ''){
				com.fnSetKeyVal(resData.invt); //출자정보
				$("#insBtn, #bank").aprojlass('hide');//신청버튼 숨김
				$(".upt").aprojlass("hide");//input 숨김
				
				//처리상태가 접수중일땐 수정,삭제 버튼 보임
				if(resData.invt.procStat == "10"){
					$("#uptBtn, #delBtn").removeClass("hide");
				}
			}
		}
	
		//추가출자신청 필수체크, 전자서명
		var fnSave = function(valChks){
			var valChks = ["investDt", "investNum"]; //필수체크
			var plan = ""; //인증서 내용
			var type = $("#mod").attr("title");
			
			if(com.fnValChk(valChks)){
				if(confirm(type + " 등록 하시겠습니까?")){
					
					//인증서 내용
					var investDt = $("#investDt").val().split("-");
			        var faceAmt = $("#faceAmt").val();
			        var investNum = $("#investNum").val();
			        var investAmt = $("#investAmt").val();

			        plan = "출자일자 : " + investDt[0] + "년 "+investDt[1] + "월 " + investDt[2] + "일"
			                + "\n좌당액면가 : " + faceAmt
			                + "\n출자좌수 : " + investNum
			                + "\n출자금액 : " + investAmt;
					         
					//alert(plan);								
					param = {plan:plan, idn:""};
					com.fnCertSign(param); //전자서명 처리
					
					//fnCertSingCallBack();
				}
			}
		}
		
		//전자서명 콜백
		var fnCertSingCallBack = function(rVal){
			if($("#mod").val() === "mod"){
				fnInvtUpt(); //추가출자 수정
			}else if($("#mod").val() === "del"){
				fnInvtDel();//추가출자 삭제
			}else{
				fnInvtIns();//추가출자 신청
			}
		}
		
		//추가출자 신청
		var fnInvtIns = function(){
			param = {};
			obj = {url:"/invtReq/insertInvtReq.do", param:param, formId:"invtIns", callBack:fnInvtInscallback, msgYn:"N", sessYn:"N", loadYn:"N"};
			com.fnAjaxPost(obj); 
		}
		
		//추가출자 수정페이지(input활성화)
		var fnInvtUptPage = function(){
			$("#mod").val("mod");
			$("#mod").attr("title","수정");
			$(".upt").removeClass("hide");
			$("td span[id^='ele']").aprojlass("hide");
			
			$("#uptBtn").attr("onclick", "fnSave()");//추가출자 수정
			$("#delBtn").attr("onclick", "fnInvtCancel()");//취소버튼
			$("#delBtn").text("취소");//취소버튼
		}
		
		//추가출자 삭제페이지
		var fnInvtDelPage = function(){
			$("#mod").val("del");
			$("#mod").attr("title","삭제");
			fnSave();
		}
		
		//추가출자 취소
		var fnInvtCancel = function(){
			$(".upt").aprojlass("hide");
			$("td span[id^='ele']").removeClass("hide");
			
			$("#uptBtn").attr("onclick", "fnInvtUptPage()");//추가출자 수정페이지
			$("#delBtn").attr("onclick", "fnInvtDelPage()");//삭제버튼
			$("#delBtn").text("삭제");//삭제버튼
		}
		
		//추가출자 수정
		var fnInvtUpt = function(){
			param = {};
			obj = {url:"/invtReq/updateInvtReq.do", param:param, formId:"invtIns", callBack:fnInvtInscallback, msgYn:"N", sessYn:"N", loadYn:"N"};
			com.fnAjaxPost(obj); 
		}
		
		//추가출자 삭제
		var fnInvtDel = function(){
			param = {};
			obj = {url:"/invtReq/deleteInvtReq.do", param:param, formId:"invtIns", callBack:fnInvtInscallback, msgYn:"N", sessYn:"N", loadYn:"N"};
			com.fnAjaxPost(obj); 
		}
		
		//추가출자 신청,수정,삭제 콜백
		var fnInvtInscallback = function(result){
			alert(result.resultMsg);
			fnPage('2030105');//추가출자리스트
		}
		
		/*]]>*/
	</script>
        <div class="main-top sub">
			<ul class="inner">
                <li class="move1"></li>
                <li class="move2"></li>
                <li class="move3"></li>
                <li class="move4"></li>
                <li class="move5"></li>
            </ul>
        </div>
        <div class="content-wrap">
            <div class="inner">
                <div class="content-box flex-box jc-between">
                    <!-- 업무 안내 영역 -->
                    <div id="lnb" class="lnb-wrap">
                        <h3 class="ko-bold h3-txt"></h3>
                    </div>

                    <!-- 업무 안내 영역 끝 -->
                    <div class="content-main">
						<!-- 경로 영역 시작 -->
                        <div th:insert="~{/fragments/subTitle}"></div>
                        <!-- 경로 영역 끝 -->
                        <form name="invtIns" id="invtIns" onSubmit="return false">
							<input type="hidden" th:name="_csrf" th:value="${_csrf?.token}"/>
							<input type="hidden" name="investNo" id="investNo" th:value="${paramMap.investNo}"/>
							<input type="hidden" name="signedInvestCont" id="signedCont" value=""/>
							<input type="hidden" name="mod" id="mod" value="" title="신청"/>
	                        <section id="content" class="content">
	                            <!-- 여기서부터 content -->
	                            <div>
	                                <article id="membInfo">
	                                    <p class="title-dept1">조합원정보</p>
	                                    <div class="table-wrap info">
	                                        <div class="table-scroll">
	                                            <table summary="조합원정보">
													<colgroup>
	                                                    <col style="width:13%;">
	                                                    <col style="width:22%;">
	                                                    <col style="width:11%;">
	                                                    <col style="width:18%;">
	                                                    <col style="width:12%;">
	                                                    <col style="width:24%;">
	                                                </colgroup>
	                                                <tbody>
	                                                    <tr>
	                                                        <th>조합원</th>
	                                                        <td id="ele_membNm"></td>
	                                                        <th>대표자</th>
	                                                        <td id="ele_ceoNm"></td>
	                                                        <th>주장르</th>
	                                                        <td id="ele_mainBussNm"></td>
	                                                    </tr>
	                                                    <tr>
	                                                        <th>사업자번호</th>
	                                                        <td id="ele_bizNo"></td>
	                                                        <th>법인등록번호</th>
	                                                        <td id="ele_lawNo"></td>
	                                                        <th>소속단체</th>
	                                                        <td id="ele_belong"></td>
	                                                    </tr>
	                                                    <tr>
	                                                        <th>전화번호</th>
	                                                        <td  id="ele_telNo"></td>
	                                                        <th>주소</th>
	                                                        <td id="ele_addrFull" colspan="3"></td>
	                                                    </tr>
	                                                </tbody>
	                                            </table>
	                                        </div>
	                                    </div>
	                                </article>
	                                <article>
	                                    <p class="title-dept1">출자정보</p>
	                                    <div class="table-wrap info">
	                                        <div class="table-scroll">
	                                            <table summary="출자정보">
													<colgroup>
	                                                    <col style="width:13%;">
	                                                    <col style="width:37%;">
	                                                    <col style="width:13%;">
	                                                    <col style="width:37%;">
	                                                </colgroup>
	                                                <tbody>
	                                                    <tr>
	                                                        <th>출자구분</th>
	                                                        <td id="ele_investNm">추가출자</td>
	                                                        <th>처리상태</th>
	                                                        <td id="ele_procStatNm">신청</td>
	                                                    </tr>
	                                                    <tr>
	                                                        <th>출자일자</th>
	                                                        <td>
																<span id="ele_investDt"></span>
																<div class="flex-box al-center upt hide" style="width:160px">
																	<input type="text" name="investDt" id="investDt" title="출자일자" style="width:120px;" maxlength="10" onkeyup="com.fnOnlyNum(this);com.fnDateMakeForm(this); com.selectFaceDeal();" onblur="com.fnDateValiChk(this)" autocomplete="off"/>
                                                        			<img src="../images/icon_calendar.png" alt="달력" class="calendar-box" onclick="calendar(this, 'investDt', 'yyyy-mm-dd','','',com.selectFaceDeal)" />
                                                        		</div>
															</td>
	                                                        <th>좌당액면가</th>
	                                                        <td>
																<span id="ele_dealAmt"></span>
																<input type="text" name="dealAmt" id="dealAmt" class="upt hide" title="좌당액면가" readonly=""/>	
																<input type="hidden" name="faceAmt" id="faceAmt" value="1,000,000"/>
															</td>
	                                                    </tr>
	                                                    <tr>
	                                                        <th>출자좌수</th>
	                                                        <td>
																<span id="ele_investNum"></span>
																<input type="text" id="investNum" name="investNum" class="upt hide" title="줄자좌수" maxlength="5" onkeyup="com.fnOnlyNum(this);com.makeComma(this); com.fnCalcByNum();" autocomplete="off"/>
															</td>
	                                                        <th>출자금액</th>
	                                                        <td>
																<span id="ele_investAmt"></span>
																<input type="text" id="investAmt" name="investAmt" class="upt hide" title="금액" readonly=""/>
															</td>
	                                                    </tr>
	                                                    <tr>
	                                                        <th>비고</th>
	                                                        <td colspan="3">
																<span id="ele_remark"></span>
																<textarea id="remark" name="remark" class="upt hide" cols="50" rows="3" title="비고"></textarea>
															</td>
	                                                    </tr>
	                                                </tbody>
	                                            </table>
	                                        </div>
	                                    </div>
	                                    <p id="bank" class="mt10 hide"> 입금계좌 : 기업은행, 935-005619-04-058 (동양정보서비스)</p>
	                                </article>
	                                <div class="btn-wrap flex-box jc-end gap-10 m-col">
	                                    <button id="insBtn" type="button" class="sub-btn2 btn-color blue hide onlyPc" onclick="fnSave()">신청</button>
	                                    <button id="uptBtn" type="button" class="sub-btn2 btn-color green hide onlyPc" onclick="fnInvtUptPage()">수정</button>
	                                    <button id="delBtn" type="button" class="sub-btn2 btn-color orange hide onlyPc" onclick="fnInvtDelPage()">삭제</button>
	                                    <button type="button" class="sub-btn2 btn-black" onclick="fnPage('2030105')">목록</button>
	                                </div>
	                            </div>
	                        </section>
                        </form>
                    </div>
                </div>
            </div>
        </div>
</html>