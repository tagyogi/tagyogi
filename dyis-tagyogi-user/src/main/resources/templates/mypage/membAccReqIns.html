<!--
	시스템구분 : 홈페이지
	파일정보 : membAccReqIns.html
	파일명 : membAccReqIns.html
	업무명 : 마이페이지 - 계좌입금의뢰서 신청 현황
	생성자 : 변성균
	생성일 : 2023.06.21
-->
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xml:lang="ko">

	<script th:inline="javascript">
		/*<![CDATA[*/
		var codeList = /*[[${codeList}]]*/ //공통코드

		var today = /*[[${today}]]*/
		var yyyy = today.substring(0,4);
		var mm = today.substring(5,7);
		var dd = today.substring(8,10);

		var procYn = false;
		//화면 초기화 처리 호출
		$(document).ready(function(){
			//lnb 세팅함수
			fnPageLnbSet(/*[[${menuInfo}]]*/); //lnb세팅


			com.fnCodeSelectBox("CM02", "bankCd", 1, ""); //은행코드

			//일자 설정
			$("#ele_today").text(yyyy+"년 " + mm +"월 " + dd + "일 ");
			//업로드
			com.fnIbsUpload($("#myUpload"), 1, "gif,jpg,jpeg,png,bmp,GIF,JPG,JPEG,PNG,BMP,pdf,PDF");

			//진행내역 조회
			var param = {};
			obj = {url:"/memb/selectMembAccReqList.do", param:param, callBack:fnSerchCallBack, msgYn:"N", sessYn:"Y", loadYn:"Y"};
			com.fnAjaxDef(obj);
		});

		var fnSerchCallBack = function(resData){
			if(resData.accReqList.length !== 0){
				alert("현재 진행중인 신청건이 있습니다.담당자에게 문의 바랍니다.");
				$("#reqBtn").remove();
				$("#reqtxt").show();
				return;
			}else{
				procYn = true;
			}
		}

		//저장전 이미 등록된 계좌인지 확인
		var fnPreSave = function(){
			acctNo = $("#acctNo").val();
			if(acctNo === "" || acctNo === undefined) {
				alert("신청할 계좌정보를 입력해주세요");
				return;
			}
			sAcctNo = acctNo.replace(/-/gi, "");
			var param = {sBankCd: $("#bankCd").val(), sAcctNo: sAcctNo};
			obj = {url:"/memb/selectMembAccMngList.do", param:param, callBack:fnPreSaveCallBack, msgYn:"N", sessYn:"Y", loadYn:"Y"};
			com.fnAjaxDef(obj);
		}

		var fnPreSaveCallBack = function(resData){
			if(resData.accList.length !== 0){
				alert("이미 등록된 계좌입니다. 자세한사항은 문의바랍니다.");
				return;
			}else{
				//저장 호출
				fnSave();
			}
		}

		var fnSave = function(){

			var fileList = $("#myUpload").IBUpload('fileList');
			if(fileList.length === 0){
				alert("통장사본을 첨부하시기 바랍니다.");
				return;
			}

			if(procYn){
				if(confirm("계좌입금의뢰서 신청을 등록 하시겠습니까?")){

					let plan = "신청일자 : "	+ today + "\n" +
								"신청자 : " 	+ $("#membNm").val() + "\n" +
								"은행명 : "	+ $("#bankCd option:selected").text() + "\n" +
								"계좌번호 : "	+ $("#acctNo").val() + "\n" +
								"예금주명 : "	+ $("#depoNm").val() + "\n";

					alert(plan);
					param = {plan:plan, idn:""};
					com.fnCertSign(param); //전자서명 처리
				}
			}else{
				alert("현재 진행중인 신청건이 있습니다.담당자에게 문의 바랍니다.");
				return;
			}
		}

		//서명 콜백
		var fnCertSingCallBack = function(rVal){
			//저장
			obj = {url:"/memb/insertMembAcc.do", formId:"saveFrm", fileId:"myUpload", callBack: com.fnDtlFileUploadCallBack, msgYn:"Y", sessYn:"Y", loadYn:"Y"};
			com.fnAjaxMulti(obj);
		}

		var fnSaveCallBack = function(resData){
			fnPage('20602');
		}


		/*]]>*/
	</script>
        <div class="main-top sub">
			<ul class="inner">
                <li class="move1"></li>
                <li class="move2"></li>
                <li class="move3"></li>
                <li class="move4"></li>
                <li class="move5"></li>
            </ul>
        </div>
        <div class="content-wrap">
            <div class="inner">
                <div class="content-box flex-box jc-between">
                    <!-- 업무 안내 영역 -->
                    <div id="lnb" class="lnb-wrap">
                        <h3 class="ko-bold h3-txt"></h3>

                    </div>

                    <!-- 업무 안내 영역 끝 -->
                    <div class="content-main">
						<!-- 경로 영역 시작 -->
                        <div th:insert="~{/fragments/subTitle}"></div>
                        <!-- 경로 영역 끝 -->
                        <form name="saveFrm" id="saveFrm" onSubmit="return false;">
						<input type="hidden" th:name="_csrf" th:value="${_csrf?.token}"/>
						<input type="hidden" name="atthType" id="atthType" value="MB07"/>
						<input type="hidden" name="atthNo" id="atthNo" value=""/>
						<input type="hidden" name="membNm" id="membNm" th:value="${session.membNm}"/>
						<input type="hidden" name="signedCont" id="signedCont" value=""/>
						<input type="hidden" name="procStat" id="procStat" value="10"/>

						<section id="content" class="content">
                            <!-- 여기서부터 content -->
                            <div>
                                <article>
                                    <p class="title-dept1">신청내용</p>
                                    <ul>
                                        <li class="ko-bold alignC font-28 mb20">계좌입금의뢰서</li>
                                        <li class="mb20"> 조합과의 거래 시 본인에게 지급되는 환불보증료 등 제 지급금을 아래 계좌로 입금하여 주실 것을
                                            의뢰합니다. 다만, 금융기관의
                                            내부사정에 의하여 발생 된 입금지연이나, 본인의 계좌 변경 시 변경신고의 지연 및 미신고와 기재오류 등에 따른 제반문제에 대하여는
                                            이의를 제기치 않을 것을 확약합니다.</li>
                                        <li class="ko-medium alignC mb10">
                                            다&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;음</li>
                                    </ul>
                                    <div class="table-wrap mb35">
                                        <div class="table-scroll">
                                            <table>
                                                <tr class="back-gray">
                                                    <th>은&nbsp;행&nbsp;명</th>
                                                    <th>계&nbsp;좌&nbsp;번&nbsp;호</th>
                                                    <th>예&nbsp;금&nbsp;주&nbsp;명</th>
                                                </tr>
                                                <tr>
                                                    <td class="alignC">
                                                        <select name="bankCd" id="bankCd" class=" w-100"></select>
                                                    </td>
                                                    <td class="alignC"><input type="text" name="acctNo" id="acctNo" class="w-100"></td>
                                                    <td class="alignC"><input type="text" name="depoNm" id="depoNm" class="w-100"></td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                    <p class="alignR" id="ele_today"></p>
                                </article>
                                <article>
                                    <p class="title-dept1">통장사본</p>
                                    <div id="myUpload" style="height:100px;"></div>
                                </article>
                                <div class="alignR">
                                    <button id="reqBtn" class="sub-btn2 btn-color"><a href="javascript:fnPreSave();">신청</a></button>
                                    <span id="reqtxt" style="display: none; color: #ff6600;">현재 진행중인 신청건이 있습니다.담당자에게 문의 바랍니다.</span>
                                </div>
                            </div>
                        </section>
                        </form>
                    </div>
                </div>
            </div>
        </div>
</html>