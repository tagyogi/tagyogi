<!--
	시스템구분 : 홈페이지
	파일정보 : lendInterCalc.html
	파일명 : lendInterCalc.html
	업무명 : 이자견적조회
	생성자 : 변성균
	생성일 : 2023.08.11
-->
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xml:lang="ko">

	<script th:inline="javascript">
		/*<![CDATA[*/

		//화면 초기화 처리 호출
		$(document).ready(function(){
			//lnb 세팅함수
			fnPageLnbSet(/*[[${menuInfo}]]*/, /*[[${paramMap.listNm}]]*/); //lnb세팅

			//이자견적 상세 조회
			fnSearchDtl();
		});

		//이자견적 상세 조회
		var fnSearchDtl = function(){
			obj = {url:"/lendInterCalc/selectLendInterCalc.do", formId:"serchFrm", callBack:fnSerchDtlCallBack, msgYn:"N", sessYn:"Y", loadYn:"Y"};
			com.fnAjaxPost(obj);
		}

		//이자견적 상세 조회 콜백
		var fnSerchDtlCallBack = function(resData){
			console.log(resData);

			//대출정보
			com.fnSetKeyVal(resData.data, "area_lend");
			$("#ele_basDt").text(/*[[${paramMap.basDt}]]*/);	//견적기준일

			//원금정보
			var delayData = resData.delayData;
			for(var key in delayData){
				$("#area_repay #ele_"+key).text( com.aprojomma(delayData[key]) );
			}

			$("#area_repay #ele_sumLendDelayAmt").text( com.aprojomma( delayData.lendAmt + delayData.delayAmt  ) );		//산출합계
			$("#area_repay #ele_sumRepayAmt").text( com.aprojomma( delayData.repayAmt + delayData.repayInterAmt ) );		//납입합계
			$("#area_repay #ele_sumRemainAmt").text( com.aprojomma( delayData.remainAmt + delayData.remainInterAmt ) );	//미납합계

			//이자정보 변수
			var interObj = {
				monthInterAmt: 0	//월이자금액
				, monthPayAmt: 0	//월이자납입액
				, monthRemainAmt: 0	//월이자잔액

				, totalDelayAmt: 0 		//연체이자액
				, totalDelayPayAmt: 0	//연체이자납입액
				, totalDelayRemainAmt: 0	//연체이자잔액

				, thisMonthInterAmt: 0 	//당월이자금액
				, thisMonthPayAmt: 0	//당월이자납입액
				, thisMonthRemainAmt: 0	//당월이자잔액
			};

			//이자납입현황리스트
			$.each(resData.list, function(index, item) {
				//당월이자 계산(asis처럼 동일하게 견적기준일이 당월이자이고, 연체금액은 합산하지 않도록 처리)
				//아래 조건은 asis와 일단 동일하게..(당월이자가 2달치가 나오는경우가 생김)
				if( $("#basDt").val().replaceAll("-","") <= item.payPreDt ){
					interObj.thisMonthInterAmt += item.interAmt;					//당월이자금액
					interObj.thisMonthPayAmt   += com.fnNvlChk(item.payAmt, 0);		//당월이자납입액
					interObj.thisMonthRemainAmt   += item.remainAmt;				//당월이자잔액
					return;
				}

				//이자정보 계산
				interObj.monthInterAmt += item.interAmt;				//월이자금액
				interObj.monthPayAmt   += com.fnNvlChk(item.payAmt, 0);	//월이자납입액
				interObj.monthRemainAmt   += item.remainAmt;			//월이자잔액

				interObj.totalDelayAmt += com.fnNvlChk(item.delayAmt, 0);			//연체이자액
				interObj.totalDelayPayAmt += com.fnNvlChk(item.delayPayAmt, 0);		//연체이자납입액
				interObj.totalDelayRemainAmt += com.fnNvlChk(item.delayAmt, 0) - com.fnNvlChk(item.delayPayAmt, 0);	//연체이자잔액

				//이자정보 리스트 처리
				var html  = '<tr>';
					html += '	<td class="alignC">'+ item.interSeq  + '</td>'; //번호
					html += '	<td class="alignC">'+ item.interTermDt + '(' + item.interDays + '일)</td>'; //이자납입기간
					html += '	<td class="alignR">'+ com.aprojomma(item.interAmt) + '</td>'; //이자금액
					html += '	<td class="alignR">'+ com.aprojomma(com.fnNvlChk(item.payAmt, 0)) + '</td>'; //납입금액
					html += '	<td class="alignR">'+ com.aprojomma(item.remainAmt) + '</td>'; 	//이자잔액
					html += '	<td class="alignR">'+ com.aprojomma(com.fnNvlChk(item.delayAmt, 0)) + '</td>';			//연체금액
					html += '	<td class="alignR">'+ com.aprojomma(com.fnNvlChk(item.delayPayAmt, 0)) + '</td>'; 		//연체납입액
					html += '	<td class="alignR">'+ com.aprojomma(com.fnNvlChk(item.delayAmt, 0) - com.fnNvlChk(item.delayPayAmt, 0)) + '</td>'; //연체잔액
					html += '</tr>';
				$("#ele_lendInterList").append(html);
			});

			//이자정보 변수 쉼표 붙혀 화면처리
			$.each(interObj, function(name, value) {
				$("#ele_"+name).text(com.aprojomma(value));
			});

			$("#ele_totalInterAmt").text( com.aprojomma(interObj.monthInterAmt + interObj.totalDelayAmt + interObj.thisMonthInterAmt) );			//이자산출합계
			$("#ele_totalInterPayAmt").text( com.aprojomma(interObj.monthPayAmt + interObj.totalDelayPayAmt + interObj.thisMonthPayAmt) );		//이자납입합계
			$("#ele_totalInterRemainAmt").text( com.aprojomma(interObj.monthRemainAmt + interObj.totalDelayRemainAmt + interObj.thisMonthRemainAmt) );	//이자미납합계
		}

		//목록이동
		var fnGoList = function(){
			fnPage('2030305');	//이자견적조회 페이지
		}

		/*]]>*/
	</script>
        <div class="main-top sub">
			<ul class="inner">
                <li class="move1"></li>
                <li class="move2"></li>
                <li class="move3"></li>
                <li class="move4"></li>
                <li class="move5"></li>
            </ul>
        </div>
        <div class="content-wrap">
            <div class="inner">
                <div class="content-box flex-box jc-between">
                    <!-- 업무 안내 영역 -->
                    <div id="lnb" class="lnb-wrap">
                        <h3 class="ko-bold h3-txt"></h3>

                    </div>

                    <!-- 업무 안내 영역 끝 -->
                    <div class="content-main">
						<!-- 경로 영역 시작 -->
                        <div th:insert="~{/fragments/subTitle}"></div>
                        <!-- 경로 영역 끝 -->
                        <form name="serchFrm" id="serchFrm" onSubmit="return false">
							<input type="hidden" th:name="_csrf" th:value="${_csrf?.token}"/>
							<input type="hidden" name="lendNo"  id="lendNo"		th:value="${paramMap.lendNo}">
							<input type="hidden" name="basDt"  	id="basDt"		th:value="${paramMap.basDt}">

	                        <section id="content" class="content">
	                            <!-- 여기서부터 content -->
	                            <div>
	                                <article>
	                                    <p class="title-dept1">대출정보</p>
	                                    <div class="table-wrap info">
	                                        <div class="v2">
	                                            <table summary="대출정보">
	                                                <colgroup>
	                                                	<col style="width:12%;">
	                                                	<col style="width:23%;">
	                                                	<col style="width:12%;">
	                                                	<col style="width:23%;">
	                                                </colgroup>
	                                                <tbody id="area_lend">
														<tr>
	                                                        <th>견적기준일</th>
	                                                        <td><span id="ele_basDt"></span></td>
	                                                        <th>대출금액</th>
	                                                        <td><span id="ele_lendAmt"></span></td>
	                                                    </tr>
														<tr>
	                                                        <th>대출일자</th>
	                                                        <td><span id="ele_lendDt"></span></td>
	                                                        <th>상환기한</th>
	                                                        <td><span id="ele_repayPreDt"></span></td>
	                                                    </tr>
	                                                </tbody>
	                                            </table>
	                                        </div>
	                                    </div>
	                                </article>
	                                <article>
	                                    <p class="title-dept1">원금정보</p>
	                                    <div class="table-wrap info">
	                                        <div class="v2">
	                                            <table summary="원금정보">
	                                                <colgroup>
	                                                	<col style="width:12%;">
	                                                	<col style="width:23%;">
	                                                	<col style="width:12%;">
	                                                	<col style="width:18%;">
	                                                	<col style="width:12%;">
	                                                	<col style="width:23%;">
	                                                </colgroup>
	                                                <tbody id="area_repay">
														<tr>
	                                                        <th>대출금액</th>
	                                                        <td><span id="ele_lendAmt"></span></td>
	                                                        <th>상환금액</th>
	                                                        <td><span id="ele_repayAmt"></span></td>
	                                                        <th>미상환대출잔액</th>
	                                                        <td><span id="ele_remainAmt"></span></td>
	                                                    </tr>
														<tr>
	                                                        <th>연체금액</th>
	                                                        <td><span id="ele_delayAmt"></span></td>
	                                                        <th>연체납입액</th>
	                                                        <td><span id="ele_repayInterAmt"></span></td>
	                                                        <th>미상환연체잔액</th>
	                                                        <td><span id="ele_remainInterAmt"></span></td>
	                                                    </tr>
	                                                    <tr>
	                                                        <th>산출합계</th>
	                                                        <td><span id="ele_sumLendDelayAmt"></span></td>
	                                                        <th>납입합계</th>
	                                                        <td><span id="ele_sumRepayAmt"></span></td>
	                                                        <th>미납합계</th>
	                                                        <td><span id="ele_sumRemainAmt"></span></td>
	                                                    </tr>
	                                                </tbody>
	                                            </table>
	                                        </div>
	                                    </div>
	                                </article>
	                                <article>
										<p class="title-dept1">이자정보</p>
										<div class="table-wrap info">
	                                        <div class="v2">
	                                            <table summary="이자정보">
	                                                <colgroup>
	                                                	<col style="width:12%;">
	                                                	<col style="width:23%;">
	                                                	<col style="width:12%;">
	                                                	<col style="width:18%;">
	                                                	<col style="width:12%;">
	                                                	<col style="width:23%;">
	                                                </colgroup>
	                                                <tbody>
														<tr>
	                                                        <th>월이자금액</th>
	                                                        <td><span id="ele_monthInterAmt"></span></td>
	                                                        <th>월이자납입액</th>
	                                                        <td><span id="ele_monthPayAmt"></span></td>
	                                                        <th>월이자잔액</th>
	                                                        <td><span id="ele_monthRemainAmt"></span></td>
	                                                    </tr>
														<tr>
	                                                        <th>연체이자액</th>
	                                                        <td><span id="ele_totalDelayAmt"></span></td>
	                                                        <th>연체이자납입액</th>
	                                                        <td><span id="ele_totalDelayPayAmt"></span></td>
	                                                        <th>연체이자잔액</th>
	                                                        <td><span id="ele_totalDelayRemainAmt"></span></td>
	                                                    </tr>
	                                                    <tr>
	                                                        <th>당월이자금액</th>
	                                                        <td><span id="ele_thisMonthInterAmt"></span></td>
	                                                        <th>당월이자납입액</th>
	                                                        <td><span id="ele_thisMonthPayAmt"></span></td>
	                                                        <th>당월이자잔액</th>
	                                                        <td><span id="ele_thisMonthRemainAmt"></span></td>
	                                                    </tr>
	                                                    <tr>
	                                                        <th>이자산출합계</th>
	                                                        <td><span id="ele_totalInterAmt"></span></td>
	                                                        <th>이자납입합계</th>
	                                                        <td><span id="ele_totalInterPayAmt"></span></td>
	                                                        <th>이자미납합계</th>
	                                                        <td><span id="ele_totalInterRemainAmt"></span></td>
	                                                    </tr>
	                                                </tbody>
	                                            </table>
	                                        </div>
	                                    </div>
	                                </article>
	                                <article>
	                                    <div class="table-wrap board">
	                                        <div class="v2">
	                                            <table class="border">
													<colgroup>
														<col style="width:5%;">
														<col style="width:22%;">
														<col style="width:10%;">
														<col style="width:10%;">
														<col style="width:10%;">
														<col style="width:10%;">
														<col style="width:10%;">
														<col style="width:10%;">
		                                            </colgroup>
	                                                <thead class="back-gray">
	                                                    <tr>
	                                                        <th scope="col">차수</th>
	                                                        <th scope="col">이자납입기간</th>
	                                                        <th scope="col">이자금액</th>
	                                                        <th scope="col">납입금액</th>
	                                                        <th scope="col">이자잔액</th>
	                                                        <th scope="col">연체금액</th>
	                                                        <th scope="col">연체납입액</th>
	                                                        <th scope="col">연체잔액</th>
	                                                    </tr>
	                                                </thead>
	                                                <tbody id="ele_lendInterList"></tbody>
	                                            </table>
	                                        </div>
	                                    </div>
	                                </article>

	                               	<!-- 버튼 영역 -->
	                                <div class="btn-wrap flex-box jc-end gap-10 m-col">
										<button type="button" class="sub-btn2 btn-white" onclick="fnGoList()">목록</button>
	                                </div>
	                            </div>
	                        </section>
	                	</form>
                    </div>
                </div>
            </div>
        </div>
</html>