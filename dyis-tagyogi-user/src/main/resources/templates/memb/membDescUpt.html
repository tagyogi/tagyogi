<!--
	시스템구분 : 홈페이지 (콘텐츠 화면 처리 영역)
	파일정보 : membDescUpt.html
	파일명 : membDescUpt.html
	업무명 : 홈페이지 (콘텐츠 화면 처리 영역)
	생성자 : 변성균
	생성일 : 2023.06.21
-->
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xml:lang="ko">

	<script th:inline="javascript">
		/*<![CDATA[*/
		//화면 초기화 처리 호출
		$(document).ready(function(){
			//lnb 세팅함수
			fnPageLnbSet(/*[[${menuInfo}]]*/, '기재변경신청현황'); //lnb세팅

			//동적 첨부파일 (다건)
			com.fnIbsUpload($("#docFile"));

			fnSelectMembDoc();
		});

		//기재변경 상세조회
		var fnSelectMembDoc = function() {
			obj = {url:"/membDoc/selectMembDoc.do", formId:"saveFrm", callBack:fnSelectMembCallBack, msgYn:"N", sessYn:"Y", loadYn:"Y"};
			com.fnAjaxPost(obj);
		}

		//상세조회 콜백
		var fnSelectMembCallBack = function(resData) {
			console.log(resData);
			com.fnSetKeyVal(resData.memb);
			com.fnSetKeyVal(resData.data);

			//$("#ceoNmChgDt, #membNmChgDt, #addrChgDt, #reqDt").datepicker(datepicker_ymd);
			//$(".upt, .ui-datepicker-trigger").removeClass('hide');

			$("#befCeoNm").val(resData.data.befCeoNm);
			$("#befMembNm").val(resData.data.befMembNm);
			$("#befAddr").val(resData.data.befAddr);

			$("#bizNo").val(resData.memb.bizNo);
			$("#lawNo").val(resData.memb.lawNo);
			$("#membNm").val(resData.memb.membNm);

			//대표자명 변경
			if(resData.data.ceoNmChgYn !== null) {
				$("#ceoNmChgYn").prop("checked", true);
			}

			//상호명 변경
			if(resData.data.membNmChgYn !== null) {
				$("#membNmChgYn").prop("checked", true);
			}

			//주소 변경
			if(resData.data.addrChgYn !== null) {
				$("#addrChgYn").prop("checked", true);
			}

			//4. 첨부파일
			com.fnIbsUploadView($("#docFile"), resData.fileList);

			//주소선택
			$("input[name=chgAddrDiv][value="+resData.data.chgAddrDiv+"]").prop("checked", true);
			
			//알림톡세팅
			var setParam = {membNo: resData.memb.membNo, setTalk:"Y"}
			com.fnSetPersList(setParam);


		}

		//주소 검색
		var fnAddrSerch = function() {
	      com.fnAddrSerch("popup");
	    }

	    //주소 검색 콜백
	    var fnAddrCallBack = function(resData) {
			//console.log(resData);
			$("#chgPostNo").val(resData.zipNo); //우편
			$("#chgDoroCd").val(resData.rnMgtSn); //도로코드
			$("#chgDoroNm").val(resData.roadAddrPart1); //도로명
			$("#chgDoroBunho").val(resData.doroBunho); //도로번지
			$("#chgDoroDong").val(resData.emdNm); //주소동
			$("#chgDoroBdNo").val(resData.doroBdNo); //주소번지

			$("#chgAddr1").val(resData.jibunAddr);//지번주소

				$("#chgAddrFullDoro").val(resData.roadAddrPart1 + "(" + resData.emdNm + " " + resData.doroBdNo + ")"); //주소번지
		}

		//checkbox 제어시 input 제어
		var fnEnable = function(id, isEnable){
			var $obj = $("#"+id);
			if(isEnable){
				$obj.attr("readonly", !isEnable);
			} else{
				$obj.attr("readonly", !isEnable);
			}
		}

		//checkbox 제어
		var fnCheckChg = function(fieldNm, obj, chgDt){
			if(chgDt === "" || chgDt === null || chgDt === undefined) {
				chgDt = /*[[${today}]]*/;
				com.fnDateFormat(chgDt);
			}

			var idDt = fieldNm + "ChgDt";
			var isEnable = obj.checked;

			if(fieldNm === "addr") {
				fnEnable("chgPostNo", isEnable);
				fnEnable("chgAddr2", isEnable);
				fnEnable("chgDoroDtl", isEnable);
			} else if(fieldNm === "ceoNm") {
				fnEnable("chgCeoNm", isEnable);
			} else {
				fnEnable("chgMembNm", isEnable);
			}

			fnEnable(idDt, isEnable);
			$("#"+idDt).val((isEnable?chgDt:""));
			if(!isEnable) {
				if(fieldNm === "ceoNm" || fieldNm === "membNm"){
					$("#chgCeoNm").val("");
					$("#chgMembNm").val("");
				}
				if(fieldNm === "addr") {
					$("#addrDiv").val("");
					$("#doroCd").val("");
					$("#doroNm").val("");
					$("#doroDong").val("");
					$("#doroBunho").val("");
					$("#doroBdNo").val("");
				}
			}
		}

		var fnSave = function(){

			//대표자 변경 체크
			if(!$("#ceoNmChgYn").is(":checked")){
				if(!$("#membNmChgYn").is(":checked")) {
					if(!$("#addrChgYn").is(":checked")) {
						alert("선택된 변경 내역이 없습니다.");
						return;
					}
				}
			}

			if($("#ceoNmChgYn").is(":checked")){
				if($.trim($("#ceoNmChgDt").val()) === ""){
					alert("변경일자를 입력해야합니다");
					$("#ceoNmChgDt").focus();
					return;
				}

				if($.trim($("#chgCeoNm").val()) === "") {
					alert("변경 후 대표자명을 입력해야합니다.");
					$("#chgCeoNm").focus();
					return;
				}
			}

			//업체명 변경 체크
			if($("#membNmChgYn").is(":checked")){
				if($.trim($("#membNmChgDt").val()) === ""){
					alert("변경일자를 입력해야합니다");
					$("#membNmChgDt").focus();
					return;
				}

				if($.trim($("#chgMembNm").val()) === "") {
					alert("변경 후 상호명을 입력해야합니다.");
					$("#chgMembNm").focus();
					return;
				}
			}

			//주소 변경 체크
			if($("#addrChgYn").is(":checked")){
				if($.trim($("#addrChgDt").val()) === ""){
					alert("변경일자를 입력해야합니다");
					$("#addrChgDt").focus();
					return;
				}

				if($.trim($("#chgPostNo").val()) === "") {
					alert("변경 후 주소를 입력해야합니다.");
					$("#chgAddr2").focus();
					return;
				}
			}

			if(confirm("기재변경정보를 저장하시겠습니까?")){
				var param;

				let plan = "신청일자 : "				+ $("#reqDt").val().replace(/\-/g,'') + "\n" +
						   "신청자 : "				+ $("#reqNm").val() +
						   "상호 : " 					+ $("#membNm").val() + "\n" +
						   "대표자 명: "				+ $("#ceoNm").val() + "\n" +
						   "법인번호 : "				+ $("#lawNo").val() + "\n\n"
							;
				param = {plan:plan, idn:$("#bizNo").val(), loginYn:$("#loginYn").val()};
				com.fnCertSign(param); //전자서명 처리
			}
		}

		//전자서명 콜백
		var fnCertSingCallBack = function(resData){
			$("#signData").val(resData.signData);

			var param = $("#saveFrm").serializeObject();

			var fileList = $("#docFile").IBUpload('fileList');

			if(fileList.length === 0){
				alert("사업자등록증사본을 첨부하십시오.");
				return;
			}

			//첨부파일 첨부한 순서 코드따오기 (물리적저장순서 맞춰야해서 필수)
			com.fnGetModCds("docFile");

			obj = {url:"/membDoc/updateMembDesc.do", callBack:fnSaveCallBack, fileId:"docFile", jParam:param,  msgYn:"Y", loadYn:"Y", sessYn:"N"};
			com.fnAjaxMulti(obj);
		}

		var fnSaveCallBack = function(){
			fnPage("2030101");
		}



		/*]]>*/
	</script>
        <div class="main-top sub">
			<ul class="inner">
                <li class="move1"></li>
                <li class="move2"></li>
                <li class="move3"></li>
                <li class="move4"></li>
                <li class="move5"></li>
            </ul>
        </div>
        <div class="content-wrap">
            <div class="inner">
                <div class="content-box flex-box jc-between">
                    <!-- 업무 안내 영역 -->
                    <div id="lnb" class="lnb-wrap">
                        <h3 class="ko-bold h3-txt"></h3>

                    </div>

                    <!-- 업무 안내 영역 끝 -->
                    <div class="content-main">
						<form id="saveFrm" name="saveFrm" onSubmit="return false">
							<input type="hidden" th:name="_csrf" th:value="${_csrf?.token}"/>
							<input type="hidden" name="membNo" id="membNo" th:value="${session.membNo}"/>
							<input type="hidden" name="reqNo" id="reqNo" th:value="${paramMap.reqNo}"/>
							<input type="hidden" name="membNm" id="membNm" value="" />
							<input type="hidden" name="bizNo" id="bizNo" value="" />
							<input type="hidden" name="ceoNm" id="ceoNm" value="" />
							<input type="hidden" name="signData" id="signData" />
							<input type="hidden" name="loginYn" id="loginYn" value="Y" />
							<input type="hidden" name="procStat" id="procStat" value="10" />
							<input type="hidden" name="atthType" id="atthType" th:value="${menuInfo.atthType}"/>
							<input type="hidden" name="atthNo"   id="atthNo" value="" />
						<!-- 경로 영역 시작 -->
                        <div class="content-top flex-box jc-between">
							<h2 class="ko-bold">[[${menuInfo.menuNm}]]</h2>
                            <div>[[${menuInfo.menuPath}]] <b>[[${menuInfo.menuNm}]]</b></div>
                        </div>
                        <!-- 경로 영역 끝 -->
                        <section id="content" class="content">
                            <!-- 여기서부터 content -->
                            <div>
                                <article>
                                    <p class="title-dept1">조합원정보</p>
                                    <div class="table-wrap info">
                                        <div class="table-scroll">
                                            <table summary="조합원정보">
                                                <colgroup>
                                                    <col style="width:12%;">
                                                    <col style="width:23%;">
                                                    <col style="width:12%;">
                                                    <col style="width:18%;">
                                                    <col style="width:12%;">
                                                    <col style="width:23%;">
                                                </colgroup>
                                                <tbody>
                                                    <tr>
                                                        <th>조합원</th>
                                                        <td><span id="ele_membNo"></span>&nbsp;&nbsp;/&nbsp;&nbsp;<span id="ele_membNm"></span></td>
                                                        <th>대표자</th>
                                                        <td><span id="ele_ceoNm"></span></td>
                                                        <th>주장르</th>
                                                        <td><span id="ele_mainBussNm"></span></td>
                                                    </tr>
                                                    <tr>
                                                        <th>사업자번호</th>
                                                        <td><span id="ele_bizNo"></span></td>
                                                        <th>법인등록번호</th>
                                                        <td><span id="ele_lawNo"></span></td>
                                                        <th>소속단체</th>
                                                        <td><span id="ele_belong"><span></td>
                                                    </tr>
                                                    <tr>
                                                        <th>전화번호</th>
                                                        <td><span id="ele_telNo"></span></td>
                                                        <th>주소</th>
                                                        <td colspan="3"><span id="ele_addrFullDoro"></span></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </article>
                                <article>
                                    <p class="title-dept1">변경정보</p>
                                    <div class="table-wrap info">
                                        <div class="table-scroll">
                                            <table summary="변경정보">
                                                <colgroup>
                                                    <col style="width:10%;">
                                                    <col style="width:5%;">
                                                    <col style="width:17%;">
                                                    <col style="width:30%;">
                                                    <col style="width:38%;">
                                                </colgroup>
                                                <tbody>
                                                    <tr>
                                                        <th colspan="2">변경구분</th>
                                                        <th rowspan="2">변경일자</th>
                                                        <th rowspan="2">변경전사항</th>
                                                        <th rowspan="2">변경후사항</th>
                                                    </tr>
                                                    <tr>
                                                        <th>내용</th>
                                                        <th class="br-1">체크</th>
                                                    </tr>
                                                    <tr>
                                                        <th>대표자</th>
                                                        <td class="alignC"><input type="checkbox" name="ceoNmChgYn" id="ceoNmChgYn" value="Y" class="nowrap" onclick="fnCheckChg('ceoNm', this)"></td>
                                                        <td>
															<div class="flex-box al-center" style="width:160px">
																<input type="text" name="ceoNmChgDt" id="ceoNmChgDt" class="upt" title="대표자변경일" style="width:120px;" onkeyup="com.fnOnlyNum(this);com.fnDateMakeForm(this);" onblur="com.fnDateValiChk(this)" autocomplete="off" readonly/>
                                                        		<img src="../images/icon_calendar.png" alt="달력" class="calendar-box" onclick="calendar(this, 'ceoNmChgDt', 'yyyy-mm-dd')" />
                                                        	</div>
                                                        </td>
                                                        <td><input type="text" name="befCeoNm" id="befCeoNm" readonly></td>
                                                        <td><input type="text" name="chgCeoNm" id="chgCeoNm" readonly></td>
                                                    </tr>
                                                    <tr>
                                                        <th>업체명</th>
                                                        <td class="alignC"><input type="checkbox" name="membNmChgYn" id="membNmChgYn" value="Y" class="nowrap" onclick="fnCheckChg('membNm', this)"></td>
                                                        <td>
															<div class="flex-box al-center" style="width:160px">
																<input type="text" name="membNmChgDt" id="membNmChgDt" class="upt" title="상호변경일" style="width:120px;" onkeyup="com.fnOnlyNum(this);com.fnDateMakeForm(this);" onblur="com.fnDateValiChk(this)" autocomplete="off" readonly/>
                                                        		<img src="../images/icon_calendar.png" alt="달력" class="calendar-box" onclick="calendar(this, 'membNmChgDt', 'yyyy-mm-dd')" />
                                                        	</div>
                                                        </td>
                                                        <td><input type="text" name="befMembNm" id="befMembNm" readonly></td>
                                                        <td><input type="text" name="chgMembNm" id="chgMembNm" readonly></td>
                                                    </tr>
                                                    <tr>
                                                        <th>주소</th>
                                                        <td class="alignC"><input type="checkbox" name="addrChgYn" id="addrChgYn" value="Y" class="nowrap" onclick="fnCheckChg('addr', this)"></td>
                                                        <td>
															<div class="flex-box al-center" style="width:160px">
																<input type="text" name="addrChgDt" id="addrChgDt" class="upt" title="주소변경일" style="width:120px;" onkeyup="com.fnOnlyNum(this);com.fnDateMakeForm(this);" onblur="com.fnDateValiChk(this)" autocomplete="off" readonly/>
																<img src="../images/icon_calendar.png" alt="달력" class="calendar-box" onclick="calendar(this, 'addrChgDt', 'yyyy-mm-dd')" />
                                                        	</div>
														</td>
                                                        <td><input type="text" name="befAddr" id="befAddr" readonly></td>

                                                        <td>
															<!--<input type="hidden" name="addrDiv" value="DR" />-->
															<input type="hidden" name="chgDoroCd" id="chgDoroCd" title="" />
															<input type="hidden" name="chgDoroNm" id="chgDoroNm" title="" />
															<input type="hidden" name="chgDoroBunho" id="chgDoroBunho" title="" />
															<input type="hidden" name="chgDoroDong" id="chgDoroDong" title="" />
															<input type="hidden" name="chgDoroBdNo" id="chgDoroBdNo" title="" />

				                                            <div class="flex-box fd-col gap-10">
				                                                <label for="chgPostNo" class="flex-box al-center gap-5 position-r">
				                                                    <span class="white-no w-70px fs-0">우편번호 </span>
				                                                    <input id="chgPostNo" name="chgPostNo" type="text" readonly="readonly" style="width:200px;">
				                                                    <button type="button" class="address-btn3" onclick="fnAddrSerch()"></button>

				                                                </label>
				                                                <label for="chgAddrFullDoro" class=" flex-box al-center gap-5">
																	<label for="DR" class="w-70px fs-0"><input type="radio" id="DR" name="chgAddrDiv" value="DR" class="input1" checked="checked"><span>도로</span></label>
				                                                    <input type="text" name="chgAddrFullDoro" id="chgAddrFullDoro" title="도로주소" style="width:200px;" readonly/>
																	<input type="text" name="chgDoroDtl" id="chgDoroDtl" title="도로상세" style="width:130px;" maxlength="50" />
				                                                </label>
				                                                <label for="chgAddr1" class="flex-box al-center gap-5">
																	<label for="JB" class="w-70px fs-0"><input type="radio" id="JB" name="chgAddrDiv" value="JB" class="input1" ><span>지번</span></label>
				                                                    <input type="text" name="chgAddr1" id="chgAddr1" title="" style="width:200px;" readonly/>
																	<input type="text" name="chgAddr2" id="chgAddr2" title="" style="width:130px;" maxlength="150"/>
				                                                </label>
				                                            </div>

                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <th>기타</th>
                                                        <td colspan="4"><input type="text" name="remark" id="ele_remark" maxlength="100" ></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </article>
                                <article>
                                    <p class="title-dept1">신청정보<span style="font-size: 13px; color: #ff6600"> (첨부할 파일을 끌어다 놓으시거나, 마우스 오른쪽버튼 -> '추가'로 첨부바랍니다.)</span></p>
                                    <div class="table-wrap info">
                                        <div class="table-scroll">
                                            <table summary="신청정보">
                                                <colgroup>
                                                    <col style="width:20%;">
                                                    <col style="width:30%;">
                                                    <col style="width:20%;">
                                                    <col style="width:30%;">
                                                </colgroup>
                                                <tbody>
                                                    <tr>
                                                        <th>신청일자</th>
                                                        <td>
															<div class="flex-box al-center" style="width:160px">
																<input type="text" name="reqDt" id="reqDt" class="upt" title="신청일자" style="width:120px;" onkeyup="com.fnOnlyNum(this);com.fnDateMakeForm(this);" onblur="com.fnDateValiChk(this)" autocomplete="off"/>
                                                        		<img src="../images/icon_calendar.png" alt="달력" class="calendar-box" onclick="calendar(this, 'reqDt', 'yyyy-mm-dd')" />
                                                        	</div>
														</td>
                                                        <th>신청자</th>
                                                        <td><input type="text" name="reqNm" id="reqNm" maxlength="20"></td>
                                                    </tr>
                                                    <tr>
                                                        <th>첨부파일</th>
                                                        <td colspan="3">
                                                            <div id="docFile" style="height:140px;"></div>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </article>
                                
                                <!--알림톡정보 : s-->
								<th:block th:include="com/comAlarmTalk"></th:block> <!--알람톡정보 -->
								<!--<th:block th:include="com/comAlarmTalk :: type('invtSeprt')"></th:block> -->
								<!--알림톡정보 : e-->
                                
                                <div class="btn-wrap flex-box jc-end gap-10 m-col">
                                    <button id="insBtn" type="button" class="sub-btn2 btn-color onlyPc" onclick="fnSave()">신청</button>
                                    <button id="uptBtn" type="button" class="sub-btn2 btn-color hide onlyPc" onclick="fnUptPage()">수정</button>
                                    <button id="delBtn" type="button" class="sub-btn2 btn-color orange hide onlyPc" onclick="fnDelPage()">삭제</button>
                                    <button type="button" class="sub-btn2 btn-white" onclick="fnPage('2030101')">목록</button>
	                            </div>
                            </div>
                        </section>
                        </form>
                    </div>
                </div>
            </div>
        </div>
</html>